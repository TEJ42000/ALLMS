{% extends "base.html" %}

{% block title %}Flashcards - ECHR Learning{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/flashcard-viewer.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üìá Flashcards</h1>
        <p class="subtitle">Study and review key concepts</p>
    </div>

    <!-- Flashcard Set Selection -->
    <div class="flashcard-sets" id="flashcard-sets">
        <h2>Select a Flashcard Set</h2>
        <div class="sets-grid">
            <!-- Flashcard sets will be loaded here -->
            <div class="loading">Loading flashcard sets...</div>
        </div>
    </div>

    <!-- Flashcard Viewer Container -->
    <div id="flashcard-viewer-container" style="display: none;">
        <div class="viewer-header">
            <button class="btn-back" id="btn-back-to-sets">
                ‚Üê Back to Sets
            </button>
            <h2 id="set-title">Flashcard Set</h2>
        </div>
        <div id="flashcard-viewer"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/flashcard-viewer.js') }}"></script>
<script>
    // Flashcard data and initialization
    let flashcardViewer = null;

    // Sample flashcard sets (replace with API call)
    const flashcardSets = [
        {
            id: 1,
            title: "ECHR Fundamentals",
            description: "Basic concepts and principles of the European Convention on Human Rights",
            cardCount: 20,
            cards: [
                { question: "What does ECHR stand for?", answer: "European Convention on Human Rights" },
                { question: "When was the ECHR adopted?", answer: "November 4, 1950" },
                { question: "How many articles are in the ECHR?", answer: "59 articles" },
                { question: "What is Article 2 of the ECHR?", answer: "Right to life" },
                { question: "What is Article 3 of the ECHR?", answer: "Prohibition of torture" },
                { question: "What is Article 5 of the ECHR?", answer: "Right to liberty and security" },
                { question: "What is Article 6 of the ECHR?", answer: "Right to a fair trial" },
                { question: "What is Article 8 of the ECHR?", answer: "Right to respect for private and family life" },
                { question: "What is Article 10 of the ECHR?", answer: "Freedom of expression" },
                { question: "What is Article 11 of the ECHR?", answer: "Freedom of assembly and association" },
                { question: "Where is the European Court of Human Rights located?", answer: "Strasbourg, France" },
                { question: "How many judges are on the European Court of Human Rights?", answer: "One judge per member state" },
                { question: "What is the principle of subsidiarity in ECHR?", answer: "National authorities are primarily responsible for protecting rights" },
                { question: "What is the margin of appreciation?", answer: "Discretion given to states in implementing Convention rights" },
                { question: "What is a derogation under ECHR?", answer: "Temporary suspension of certain rights in emergencies" },
                { question: "What is Article 14 of the ECHR?", answer: "Prohibition of discrimination" },
                { question: "What is Protocol 1, Article 1?", answer: "Protection of property" },
                { question: "What is the 'living instrument' doctrine?", answer: "ECHR is interpreted in light of present-day conditions" },
                { question: "What is the exhaustion of domestic remedies rule?", answer: "Applicants must use all available national remedies before applying to ECtHR" },
                { question: "What is a pilot judgment?", answer: "Judgment addressing systemic issues affecting many cases" }
            ]
        },
        {
            id: 2,
            title: "Legal Terminology",
            description: "Essential legal terms and definitions",
            cardCount: 15,
            cards: [
                { term: "Tort", definition: "A civil wrong that causes harm or loss" },
                { term: "Plaintiff", definition: "The party who initiates a lawsuit" },
                { term: "Defendant", definition: "The party being sued or accused" },
                { term: "Burden of proof", definition: "The obligation to prove one's assertion" },
                { term: "Precedent", definition: "A legal decision that serves as an authoritative rule in future cases" },
                { term: "Jurisdiction", definition: "The authority of a court to hear and decide a case" },
                { term: "Statute", definition: "A written law passed by a legislative body" },
                { term: "Common law", definition: "Law developed through judicial decisions rather than statutes" },
                { term: "Equity", definition: "A system of law based on fairness and justice" },
                { term: "Injunction", definition: "A court order requiring a party to do or refrain from doing something" },
                { term: "Damages", definition: "Monetary compensation for loss or injury" },
                { term: "Liability", definition: "Legal responsibility for one's actions or omissions" },
                { term: "Negligence", definition: "Failure to exercise reasonable care" },
                { term: "Breach", definition: "Violation of a law, obligation, or agreement" },
                { term: "Remedy", definition: "Legal means to enforce a right or redress a wrong" }
            ]
        },
        {
            id: 3,
            title: "Case Law Essentials",
            description: "Important cases and their holdings",
            cardCount: 10,
            cards: [
                { question: "What was the holding in Handyside v UK (1976)?", answer: "Freedom of expression includes information that may offend, shock, or disturb" },
                { question: "What principle was established in Sunday Times v UK (1979)?", answer: "Restrictions on freedom of expression must be prescribed by law" },
                { question: "What was decided in Soering v UK (1989)?", answer: "Extradition may violate Article 3 if it exposes person to inhuman treatment" },
                { question: "What did McCann v UK (1995) establish?", answer: "Use of lethal force must be absolutely necessary" },
                { question: "What was the outcome of Pretty v UK (2002)?", answer: "No right to die under Article 2" },
                { question: "What principle came from Tyrer v UK (1978)?", answer: "Corporal punishment violates Article 3" },
                { question: "What was decided in Golder v UK (1975)?", answer: "Right of access to court is implicit in Article 6" },
                { question: "What did Marckx v Belgium (1979) establish?", answer: "Discrimination against children born out of wedlock violates Article 8" },
                { question: "What was the holding in Dudgeon v UK (1981)?", answer: "Criminalization of homosexual acts violates Article 8" },
                { question: "What principle was established in Airey v Ireland (1979)?", answer: "Effective access to court may require legal aid" }
            ]
        }
    ];

    // Load flashcard sets on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadFlashcardSets();
        setupBackButton();
    });

    /**
     * Load and display flashcard sets
     */
    function loadFlashcardSets() {
        const setsContainer = document.querySelector('.sets-grid');
        
        if (flashcardSets.length === 0) {
            setsContainer.innerHTML = '<p class="no-sets">No flashcard sets available yet.</p>';
            return;
        }

        setsContainer.innerHTML = flashcardSets.map(set => `
            <div class="flashcard-set-card" data-set-id="${set.id}">
                <div class="set-icon">üìö</div>
                <h3>${set.title}</h3>
                <p>${set.description}</p>
                <div class="set-meta">
                    <span class="card-count">${set.cardCount} cards</span>
                </div>
                <button class="btn-study" data-set-id="${set.id}">
                    Start Studying
                </button>
            </div>
        `).join('');

        // HIGH FIX: Use event delegation instead of inline onclick
        setsContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn-study')) {
                const setId = parseInt(e.target.getAttribute('data-set-id'));
                startFlashcards(setId);
            }
        });
    }

    /**
     * Start studying a flashcard set
     */
    function startFlashcards(setId) {
        const set = flashcardSets.find(s => s.id === setId);
        if (!set) {
            console.error('Flashcard set not found:', setId);
            return;
        }

        // Hide sets, show viewer
        document.getElementById('flashcard-sets').style.display = 'none';
        document.getElementById('flashcard-viewer-container').style.display = 'block';
        document.getElementById('set-title').textContent = set.title;

        // Initialize flashcard viewer
        if (flashcardViewer) {
            flashcardViewer.cleanup();
        }

        flashcardViewer = new FlashcardViewer('flashcard-viewer', set.cards);
        window.flashcardViewer = flashcardViewer;
    }

    /**
     * Setup back button
     */
    function setupBackButton() {
        const btnBack = document.getElementById('btn-back-to-sets');
        if (btnBack) {
            btnBack.addEventListener('click', function() {
                // Cleanup viewer
                if (flashcardViewer) {
                    flashcardViewer.cleanup();
                    flashcardViewer = null;
                }

                // Show sets, hide viewer
                document.getElementById('flashcard-sets').style.display = 'block';
                document.getElementById('flashcard-viewer-container').style.display = 'none';
            });
        }
    }
</script>

<style>
    .page-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .page-header h1 {
        font-size: 36px;
        color: #333;
        margin-bottom: 10px;
    }

    .subtitle {
        font-size: 18px;
        color: #666;
    }

    .flashcard-sets h2 {
        font-size: 24px;
        color: #333;
        margin-bottom: 20px;
    }

    .sets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .flashcard-set-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .flashcard-set-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .set-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    .flashcard-set-card h3 {
        font-size: 20px;
        color: #333;
        margin-bottom: 12px;
    }

    .flashcard-set-card p {
        font-size: 14px;
        color: #666;
        margin-bottom: 16px;
        line-height: 1.5;
    }

    .set-meta {
        margin-bottom: 16px;
    }

    .card-count {
        display: inline-block;
        padding: 4px 12px;
        background: #f0f0f0;
        border-radius: 12px;
        font-size: 12px;
        color: #666;
        font-weight: 600;
    }

    .btn-study {
        width: 100%;
        padding: 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .btn-study:hover {
        background: #5568d3;
    }

    .viewer-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .btn-back {
        padding: 10px 20px;
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-back:hover {
        background: #667eea;
        color: white;
    }

    .viewer-header h2 {
        font-size: 24px;
        color: #333;
        margin: 0;
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #666;
    }

    .no-sets {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 16px;
    }
</style>
{% endblock %}

