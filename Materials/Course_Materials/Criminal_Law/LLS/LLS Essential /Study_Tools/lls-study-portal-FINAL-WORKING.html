<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law & Legal Skills - Complete Study Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1e3a8a;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-dark: #0f172a;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --success: #22c55e;
            --warning: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 4px solid var(--primary);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: var(--bg-light);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-dark);
        }

        .nav-tab:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }

        /* Main Content */
        .main-content {
            background: white;
            margin: 2rem auto;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section {
            display: none;
            padding: 2rem;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
            border-radius: 12px;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .progress-section {
            margin-top: 2rem;
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 12px;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Week Cards */
        .weeks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .week-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .week-card:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transform: translateY(-5px);
        }

        .week-card.completed {
            border-color: var(--success);
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .week-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .week-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-complete {
            background: var(--success);
            color: white;
        }

        .status-progress {
            background: var(--warning);
            color: white;
        }

        .status-pending {
            background: var(--text-light);
            color: white;
        }

        .week-topics {
            margin-top: 1rem;
        }

        .topic-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .topic-item:last-child {
            border-bottom: none;
        }

        .topic-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
        }

        /* Practice Area */
        .practice-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .practice-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 2rem;
            border-radius: 12px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .practice-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .practice-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .practice-card h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        /* Quiz Section */
        .quiz-container {
            max-width: 800px;
            margin: 2rem auto;
        }

        .question-card {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .question-number {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .option {
            padding: 1rem;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .option:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }

        .option.selected {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .option.correct {
            border-color: var(--success);
            background: #f0fdf4;
        }

        .option.incorrect {
            border-color: var(--danger);
            background: #fef2f2;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }

        /* AI Assessment */
        .assessment-result {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
            border-left: 4px solid var(--primary);
        }

        .grade-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 2rem 0;
        }

        .feedback-section {
            margin-top: 1.5rem;
        }

        .feedback-section h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Reference Tools */
        .reference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .reference-item {
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .reference-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1.1rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #f0fdf4;
            border: 1px solid var(--success);
            color: #166534;
        }

        .alert-warning {
            background: #fffbeb;
            border: 1px solid var(--warning);
            color: #92400e;
        }

        .alert-danger {
            background: #fef2f2;
            border: 1px solid var(--danger);
            color: #991b1b;
        }

        /* Decision Model */
        .decision-tree {
            margin-top: 2rem;
        }

        .decision-node {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .decision-node::after {
            content: 'â†“';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: var(--primary);
        }

        .decision-node:last-child::after {
            display: none;
        }

        .decision-question {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .decision-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }

            .nav-tabs {
                width: 100%;
                justify-content: center;
            }

            .weeks-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Accordion */
        .accordion-item {
            border: 2px solid var(--border);
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .accordion-header {
            background: var(--bg-light);
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .accordion-header:hover {
            background: #e2e8f0;
        }

        .accordion-content {
            padding: 1.5rem;
            display: none;
        }

        .accordion-content.active {
            display: block;
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-icon.rotated {
            transform: rotate(180deg);
        }

        /* Tabs within sections */
        .sub-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .sub-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-light);
        }

        .sub-tab:hover {
            color: var(--primary);
        }

        .sub-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .sub-content {
            display: none;
        }

        .sub-content.active {
            display: block;
        }

        /* Mock Exam */
        .exam-timer {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 999;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: bold;
        }

        .exam-question {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .points {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: bold;
            margin-left: 1rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* AI TUTOR STYLES */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .api-banner-container {
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .chat-modal.show {
            display: flex;
        }

        .chat-modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #f8fafc;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            animation: slideInChat 0.3s ease-out;
        }

        @keyframes slideInChat {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .chat-message.ai .chat-avatar {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }

        .chat-message.user .chat-avatar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .chat-bubble {
            background: white;
            padding: 1.25rem 1.5rem;
            border-radius: 18px;
            max-width: 75%;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12);
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .chat-bubble p {
            margin: 0.75rem 0;
        }

        .chat-bubble p:first-child {
            margin-top: 0;
        }

        .chat-bubble p:last-child {
            margin-bottom: 0;
        }

        .chat-bubble strong {
            font-weight: 600;
        }

        .chat-bubble code {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .chat-bubble h3 {
            margin-top: 1.5rem !important;
            margin-bottom: 0.75rem !important;
        }

        .chat-bubble h3:first-child {
            margin-top: 0 !important;
        }

        .chat-message.user .chat-bubble {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
        }

        .chat-message.user .chat-bubble h3 {
            color: white !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-left-color: white !important;
        }

        .typing-indicator {
            display: none;
            padding: 1rem 1.25rem;
            background: white;
            border-radius: 18px;
            width: fit-content;
            margin-left: 56px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #64748b;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-area {
            padding: 1.5rem;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 1rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input-area input:focus {
            border-color: #1e3a8a;
        }

        .chat-input-area button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .chat-input-area button:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .chat-input-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-ai {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
        }
    </style>
</head>
<body>
    <!-- API Key Banner -->
    <div class="api-banner-container" style="background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); padding: 2rem; margin-bottom: 2rem;">
        <div style="max-width: 1400px; margin: 0 auto;">
            <div id="api-banner" style="text-align: center; color: white;">
                <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">ðŸ¤– AI Legal Tutor</h2>
                <p style="margin: 0.5rem 0 1.5rem; opacity: 0.9;">Get instant answers to your law questions - powered by Claude Sonnet 4</p>
                <div style="display: flex; gap: 1rem; max-width: 600px; margin: 0 auto;">
                    <input type="password" id="api-key-input" placeholder="Enter your Anthropic API key (sk-ant-...)" 
                           style="flex: 1; padding: 12px 20px; border-radius: 8px; border: none; font-size: 1rem;">
                    <button onclick="saveApiKey()" style="padding: 12px 30px; background: white; color: #1e3a8a; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Save Key
                    </button>
                </div>
                <p style="font-size: 0.85rem; margin-top: 1rem; opacity: 0.8;">
                    <span id="api-status">âŒ No API key set</span> | 
                    <a href="https://console.anthropic.com/" target="_blank" style="color: white; text-decoration: underline;">Get API key</a>
                </p>
            </div>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="logo">
                âš–ï¸ Law & Legal Skills - Complete Study Portal
            </div>
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showSection('dashboard')">ðŸ“Š Dashboard</div>
                <div class="nav-tab" onclick="showSection('study')">ðŸ“š Study Materials</div>
                <div class="nav-tab" onclick="showSection('practice')">âœï¸ Practice</div>
                <div class="nav-tab" onclick="showSection('mock-exam')">ðŸ“ Mock Exam</div>
                <div class="nav-tab" onclick="showSection('reference')">ðŸ“– Quick Reference</div>
                <div class="nav-tab" onclick="showSection('tools')">ðŸ› ï¸ Legal Tools</div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <h1>ðŸ“Š Your Study Dashboard</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Track your progress and access all study resources</p>

                <div class="dashboard-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <h3 id="completion-rate">0%</h3>
                        <p>Course Completion</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <h3 id="practice-count">0</h3>
                        <p>Practice Questions Completed</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                        <h3 id="mock-score">-</h3>
                        <p>Latest Mock Exam Score</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">
                        <h3 id="days-to-exam">26</h3>
                        <p>Days Until Exam (Oct 28)</p>
                    </div>
                </div>

                <div style="text-align: center; margin: 2rem 0;">
                    <button class="btn-ai" onclick="console.log('Button clicked'); openAIChat('Law & Legal Skills')">
                        ðŸ¤– Ask AI Tutor Anything
                    </button>
                    <button style="margin-left: 1rem; padding: 0.75rem 1.5rem; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer;" 
                            onclick="alert('Test button works! openAIChat type: ' + typeof openAIChat)">
                        Test Button
                    </button>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                        Get instant answers about articles, concepts, procedures, and exam prep
                    </p>
                </div>

                <div class="progress-section">
                    <h2>ðŸ“ˆ Overall Progress</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overall-progress" style="width: 0%">0%</div>
                    </div>
                </div>

                <h2 style="margin-top: 3rem;">ðŸ“… Weekly Modules</h2>
                <div class="weeks-grid" id="weeks-overview">
                    <!-- Week cards will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- Study Materials Section -->
            <div id="study" class="section">
                <h1>ðŸ“š Study Materials</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Comprehensive notes and resources for all topics</p>

                <div class="sub-tabs">
                    <div class="sub-tab active" onclick="showSubContent('study', 'week1')">Week 1</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week2')">Week 2</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week3')">Week 3</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week4')">Week 4</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week5')">Week 5</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week6')">Week 6</div>
                    <div class="sub-tab" onclick="showSubContent('study', 'week7')">Week 7</div>
                </div>

                <div id="study-week1" class="sub-content active">
                    <h2>Week 1: Introduction to Dutch Law</h2>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“– Taekema - Understanding Dutch Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Key Concepts:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Conditional Nature of Law:</strong> Legal rules have "if-then" structure</li>
                                <li><strong>Operative Facts:</strong> Facts that satisfy conditions of a legal rule</li>
                                <li><strong>Legal Consequences:</strong> Outcomes when operative facts are met</li>
                                <li><strong>Juridical Acts:</strong> Intentional actions to bring about legal consequences</li>
                            </ul>
                            
                            <h3 style="margin-top: 1.5rem;">Important Distinctions:</h3>
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Public vs Private Law</strong>
                                    Public law: Government "as such" plays a role<br>
                                    Private law: Relations between citizens
                                </div>
                                <div class="reference-item">
                                    <strong>Substantive vs Procedural</strong>
                                    Substantive: Defines rights and duties<br>
                                    Procedural: Mechanisms for enforcement
                                </div>
                                <div class="reference-item">
                                    <strong>Legal Subjects</strong>
                                    Natural persons: Human beings<br>
                                    Legal persons: Organizations with legal status
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ Hage - Basic Concepts of Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Divisions of Law:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Public Law:</strong> Constitutional, Administrative, Criminal, Public International Law</li>
                                <li><strong>Private Law:</strong> Property, Contract, Tort, Family, Commercial Law</li>
                                <li><strong>Functional Fields:</strong> EU Law, Environmental Law, ICT Law (blend of both)</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Structure of Legal Rules:</h3>
                            <p><strong>Condition Part:</strong> When the rule applies</p>
                            <p><strong>Conclusion Part:</strong> The consequences when applied</p>
                            <p><strong>Example:</strong> If [operative facts exist], then [legal consequences follow]</p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›ï¸ Lecture Notes - Dutch Legal System</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Sources of Dutch Law (Hierarchy):</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li>Treaties</li>
                                <li>Charter for the Kingdom</li>
                                <li>Constitution (Grondwet)</li>
                                <li>Acts of Parliament</li>
                                <li>Orders in Council</li>
                                <li>Ministerial Regulations</li>
                                <li>Provincial & Municipal By-laws</li>
                            </ol>

                            <h3 style="margin-top: 1.5rem;">Conflict Resolution Rules:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Lex superior derogat legi inferiori:</strong> Higher law > Lower law</li>
                                <li><strong>Lex posterior derogat legi priori:</strong> Newer law > Older law</li>
                                <li><strong>Lex specialis derogat legi generali:</strong> Specific law > General law</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Court Structure:</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>District Court (Rechtbank):</strong> 1st instance</li>
                                <li><strong>Court of Appeal (Gerechtshof):</strong> 2nd instance</li>
                                <li><strong>Supreme Court (Hoge Raad):</strong> Cassation (law only, not facts)</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div id="study-week2" class="sub-content">
                    <h2>Week 2: Constitutional Law</h2>
                    
                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›ï¸ Constitutional Principles</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Four Essential Elements of Rule of Law (Rechtsstaat):</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Separation of Powers (Trias Politica)</strong>
                                    <ul style="margin-left: 1.5rem;">
                                        <li>Legislative: Parliament + Government make laws</li>
                                        <li>Executive: Government implements laws</li>
                                        <li>Judiciary: Courts resolve disputes independently</li>
                                    </ul>
                                </li>
                                <li><strong>Legality Principle</strong>
                                    <ul style="margin-left: 1.5rem;">
                                        <li>Public bodies must act based on law</li>
                                        <li>Attribution vs Delegation of power</li>
                                    </ul>
                                </li>
                                <li><strong>Fundamental Rights</strong>
                                    <ul style="margin-left: 1.5rem;">
                                        <li>Classic rights: Civil liberties (enforceable in court)</li>
                                        <li>Social rights: State objectives (often not enforceable)</li>
                                    </ul>
                                </li>
                                <li><strong>Judicial Review</strong>
                                    <ul style="margin-left: 1.5rem;">
                                        <li>Article 120: No review of Acts of Parliament</li>
                                        <li>Article 94: Review based on self-executing treaties</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ‘‘ Dutch Monarchy & Parliament</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>States-General (Parliament):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Second Chamber (Tweede Kamer):</strong> 150 members, directly elected, proportional representation</li>
                                <li><strong>First Chamber (Eerste Kamer):</strong> 75 members, indirectly elected via provincial councils</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Role of the King:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Ceremonial head of state with limited real power</li>
                                <li>Inviolable; ministers bear responsibility (Art. 42(2))</li>
                                <li>Rights: to be consulted, to encourage, to warn</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Ministerial Responsibility:</h3>
                            <p>Ministers accountable to Parliament, not King. Rule of confidence applies (though not codified).</p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ—³ï¸ Democracy & Fundamental Rights</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Types of Fundamental Rights:</h3>
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Absolute Rights</strong>
                                    No restriction allowed<br>
                                    Examples: No torture, right to petition
                                </div>
                                <div class="reference-item">
                                    <strong>Relative Rights</strong>
                                    Can be restricted by Act of Parliament<br>
                                    Must have legitimate aim
                                </div>
                            </div>

                            <h3 style="margin-top: 1.5rem;">Legitimate Aims for Restrictions:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Public health</li>
                                <li>Prevention of disorder</li>
                                <li>Traffic safety</li>
                                <li>National security</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="study-week3" class="sub-content">
                    <h2>Week 3: Administrative Law</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“‹ General Administrative Law Act (GALA)</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Administrative Authority (Art. 1:1 GALA):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>A-authorities:</strong> Organs of legal entities under public law (State, provinces, municipalities)</li>
                                <li><strong>B-authorities:</strong> Other persons/bodies with public authority</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Types of Orders (Art. 1:3 GALA):</h3>
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>General Binding Regulations (GBRs)</strong>
                                    General, repeatable, no deviation allowed
                                </div>
                                <div class="reference-item">
                                    <strong>Administrative Measures</strong>
                                    General and specific effects
                                </div>
                                <div class="reference-item">
                                    <strong>Policy Rules</strong>
                                    Guidelines for interpretation, deviation allowed
                                </div>
                                <div class="reference-item">
                                    <strong>Administrative Decisions</strong>
                                    Individual decisions affecting specific persons
                                </div>
                            </div>

                            <h3 style="margin-top: 1.5rem;">Sanctions (Title 5 GALA):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Reparatory:</strong> Coercive action (bestuursdwang), Coercive penalty payments</li>
                                <li><strong>Punitive:</strong> Administrative fines</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ Legal Protection & Appeals</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Three Requirements for Legal Protection:</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Contestable/Appealable Order:</strong> Administrative measures and decisions (not GBRs or policy rules)</li>
                                <li><strong>Interested Party Status (Art. 1:2 GALA):</strong>
                                    <ul style="margin-left: 1.5rem;">
                                        <li>Direct: Addressee of the order</li>
                                        <li>Third party: Personal, objective, current interest causally connected</li>
                                    </ul>
                                </li>
                                <li><strong>Preliminary Procedure:</strong> Notice of objection (bezwaarschrift) required before court appeal</li>
                            </ol>

                            <h3 style="margin-top: 1.5rem;">Appeal Outcomes (Art. 8:70, 8:72 GALA):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Annul/quash decision</li>
                                <li>Find well-founded or unfounded</li>
                                <li>Return to authority</li>
                                <li>Declare inadmissible</li>
                                <li>Replace with court's own ruling</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="study-week4" class="sub-content">
                    <h2>Week 4: Criminal Law</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ Four Requirements for Criminal Liability</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Human Conduct (Actus Reus):</strong> Action or omission by a person</li>
                                <li><strong>Statutory Offence:</strong> Must be a specific crime defined in law at time of action</li>
                                <li><strong>Unlawfulness:</strong> Conduct contrary to law (unless justified)</li>
                                <li><strong>Guilt/Blameworthiness (Mens Rea):</strong> Intent, recklessness, or negligence</li>
                            </ol>

                            <div class="alert alert-warning" style="margin-top: 1rem;">
                                <strong>Note:</strong> Components must be proven in court; elements are assumed unless challenged.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ§  Intent & Negligence</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Intent (Dolus):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Purposeful action:</strong> Deliberate intention</li>
                                <li><strong>Awareness of high probability:</strong> Foreseeable consequences</li>
                                <li><strong>Recklessness:</strong> Considerable chance recognized</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Negligence (Culpa):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Conscious:</strong> Knows but disregards risk</li>
                                <li><strong>Unconscious:</strong> Careless or thoughtless (must be reproachable)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›¡ï¸ Defences</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Justifications (Remove Unlawfulness):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Statutory:</strong> Necessity (force majeure), self-defense, legal duty, authorized official orders</li>
                                <li><strong>Non-statutory:</strong> Absence of substantive unlawfulness</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Excuses (Remove Guilt):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Statutory:</strong> Necessity (duress), improper self-defense, unauthorized official order, mental disorder</li>
                                <li><strong>Non-statutory:</strong> Absence of all guilt</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“œ Criminal Trial Decision Model</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Preliminary Questions (Art. 348-349 CCP):</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li>Is the writ of summons valid?</li>
                                <li>Is the court competent?</li>
                                <li>Is prosecution admissible?</li>
                                <li>Are there grounds for suspension?</li>
                            </ol>

                            <h3 style="margin-top: 1.5rem;">Fundamental Questions (Art. 350 CCP):</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li>Can the indictment be proven?</li>
                                <li>Do the facts constitute a statutory offence?</li>
                                <li>Is the defendant punishable?</li>
                                <li>Which sanction applies?</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div id="study-week5" class="sub-content">
                    <h2>Week 5: Private Law</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“ Contract Formation</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Four Requirements for Valid Contract:</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Capacity (Art. 3:32 DCC):</strong> Parties must be competent</li>
                                <li><strong>Permissible Content (Art. 3:40 DCC):</strong> Within moral and legal rights</li>
                                <li><strong>Consensus (Art. 3:33 DCC):</strong> Mutual agreement</li>
                                <li><strong>Determinability (Art. 6:227 DCC):</strong> Obligations must be determinable</li>
                            </ol>

                            <h3 style="margin-top: 1.5rem;">Layered Structure of DCC:</h3>
                            <p>General to specific rules within books. <strong>Lex specialis derogat lege generali:</strong> Specific law prevails over general law.</p>
                            
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Book 3</strong>
                                    Patrimonial Law in General<br>
                                    General framework
                                </div>
                                <div class="reference-item">
                                    <strong>Book 6</strong>
                                    General Part of Law of Obligations<br>
                                    Specific guidelines
                                </div>
                                <div class="reference-item">
                                    <strong>Book 7</strong>
                                    Special Contracts<br>
                                    Most specific rules
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âŒ Vitiated Consent</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Grounds for Annulment (Art. 3:44 DCC):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Threat (Art. 3:44(2)):</strong> Coercion/intimidation</li>
                                <li><strong>Fraud (Art. 3:44(3)):</strong> Deliberate misrepresentation or concealment</li>
                                <li><strong>Abuse of Circumstances (Art. 3:44(4)):</strong> Exploiting vulnerable position</li>
                                <li><strong>Error (Art. 6:228 DCC):</strong> Mistake or lack of information</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Void vs Voidable:</h3>
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Void (Art. 3:40 DCC)</strong>
                                    Contrary to public order<br>
                                    Cannot give rise to legal consequences<br>
                                    Irreparable
                                </div>
                                <div class="reference-item">
                                    <strong>Voidable (Art. 3:44 DCC)</strong>
                                    Valid but can be nullified<br>
                                    Party with interest can annul<br>
                                    Retroactive effect
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš ï¸ Breach of Contract & Remedies</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Types of Breach:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Inferior Performance:</strong> Grade B instead of Grade A</li>
                                <li><strong>Late Performance:</strong> Delayed delivery</li>
                                <li><strong>Non-Performance:</strong> Refusal or impossibility</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Legal Remedies:</h3>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Remedy</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Suspend own performance</td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Art. 6:262 DCC</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Claim specific performance</td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Art. 3:296 DCC</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Damages</td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Art. 6:74 DCC</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Rescind/dissolve contract</td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Art. 6:265 DCC</td>
                                </tr>
                            </table>

                            <div class="alert alert-warning" style="margin-top: 1rem;">
                                <strong>All damages begin in Art. 6:74 DCC!</strong> Debtor liable for non-performance except force majeure.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“– Haviltex Standard</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Contract Interpretation:</h3>
                            <p style="line-height: 1.8;"><strong>Haviltex Doctrine:</strong> Interpretation based on what parties could reasonably attribute to the contract and expect from each other, considering:</p>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Their circumstances</li>
                                <li>Their expectations</li>
                                <li>Their legal knowledge</li>
                                <li>Social circles</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Reasonableness & Equity (Art. 6:248 DCC):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Supplementary Effect:</strong> Add obligations beyond literal text</li>
                                <li><strong>Restrictive Effect:</strong> Reduce or limit obligations</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="study-week6" class="sub-content">
                    <h2>Week 6: International Law</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸŒ Sources of International Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Primary Sources (Art. 38 ICJ Statute):</h3>
                            <ol style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Treaties:</strong> Written agreements (Vienna Convention 1969)</li>
                                <li><strong>International Custom:</strong> State practice (usus) + legal obligation (opinio iuris)</li>
                                <li><strong>General Principles of Law:</strong> Common across legal systems</li>
                                <li><strong>Binding Decisions:</strong> E.g., UN Security Council resolutions</li>
                            </ol>

                            <h3 style="margin-top: 1.5rem;">Subsidiary Sources:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Judicial decisions (precedents)</li>
                                <li>Scholarly writings</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›ï¸ United Nations</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Main Organs:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>General Assembly:</strong> Policy-making, non-binding recommendations</li>
                                <li><strong>Security Council:</strong> Binding decisions on peace and security
                                    <ul style="margin-left: 1.5rem;">
                                        <li>15 members: 5 permanent (US, UK, France, China, Russia) with veto</li>
                                        <li>Decisions require 9 votes including all permanent members</li>
                                    </ul>
                                </li>
                                <li><strong>International Court of Justice (ICJ):</strong> Disputes between states</li>
                                <li><strong>Secretary-General:</strong> Administrative head</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">UN Charter Key Principles:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Art. 2(1):</strong> Sovereign equality of states</li>
                                <li><strong>Art. 2(4):</strong> Prohibition of force</li>
                                <li><strong>Art. 51:</strong> Right to self-defense</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ International Court of Justice (ICJ)</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Jurisdiction (Art. 36 ICJ Statute):</h3>
                            <p style="line-height: 1.8;">ICJ jurisdiction is <strong>consensual</strong> - states must consent either:</p>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Generally (by declaration)</li>
                                <li>On a case-by-case basis (special agreement)</li>
                                <li>Through treaty provision</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Enforcement:</h3>
                            <p style="line-height: 1.8;"><strong>Art. 94 UN Charter:</strong> Compliance expected but enforcement relies on political will and Security Council.</p>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ‘¤ International Human Rights (ECHR)</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>European Court of Human Rights (ECtHR):</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Enforces European Convention on Human Rights</li>
                                <li>Jurisdiction and admissibility: Art. 32 and 35 ECHR</li>
                                <li>Focuses on civil/political rights (e.g., Art. 6 - fair trial)</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Key Rights:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Right to life (Art. 2)</li>
                                <li>Prohibition of torture (Art. 3)</li>
                                <li>Right to liberty (Art. 5)</li>
                                <li>Right to fair trial (Art. 6)</li>
                                <li>Right to privacy (Art. 8)</li>
                                <li>Freedom of religion (Art. 9)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ‡ªðŸ‡º Monism vs Dualism</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Implementation of International Law:</h3>
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Monism (Netherlands)</strong>
                                    International law automatically part of national law<br>
                                    Direct effect<br>
                                    Treaties override conflicting statutes (Art. 94)
                                </div>
                                <div class="reference-item">
                                    <strong>Dualism</strong>
                                    International law must be transformed<br>
                                    Requires legislation or incorporation<br>
                                    Separate legal systems
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="study-week7" class="sub-content">
                    <h2>Week 7: Exam Preparation</h2>

                    <div class="alert alert-warning">
                        <strong>ðŸŽ¯ Exam Date: October 28, 2025</strong><br>
                        Closed book exam with Digital Legislation Reader provided<br>
                        Time: Law (1.75 hours) + Skills (remainder)
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âœ… Exam Strategy & Tips</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>What to Study:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Content of all lectures</li>
                                <li>All assigned literature</li>
                                <li>Weekly assignments</li>
                                <li>Mock exams (SYAC, LLS questions, mock exams)</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Exam Day Guidelines:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>âœ… <strong>Use keywords</strong> - be concise and precise</li>
                                <li>âœ… <strong>Substantiate everything</strong> - back up with legislation or theory</li>
                                <li>âœ… <strong>NO bullet points</strong> - write in prose</li>
                                <li>âœ… <strong>Answer only what's asked</strong> - don't write as much as possible</li>
                                <li>âœ… <strong>Know where to look</strong> - memorize legislation structure</li>
                                <li>âœ… <strong>Time management</strong> - 1.75 hours for Law, rest for Skills</li>
                                <li>âœ… <strong>For Skills:</strong> Always refer to paragraphs; for Law refer to provisions</li>
                            </ul>

                            <h3 style="margin-top: 1.5rem;">Legislation Reader Notes:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>âœ… Allowed: Highlights, underlining, blank tabs</li>
                                <li>âŒ Not allowed: Words, codes, symbols</li>
                                <li>Focus is on understanding law, not mechanical tab use</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ”‘ Key Topics Summary</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <h3>Week 1 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Functions of law (substantive vs procedural)</li>
                                <li>Areas of law definitions</li>
                            </ul>

                            <h3>Week 2 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>State definitions and requirements</li>
                                <li>Unitary, federation, confederation distinctions</li>
                                <li>Fundamental rights: Classic vs Social</li>
                            </ul>

                            <h3>Week 3 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Types of orders (Art. 1:3)</li>
                                <li>GBR, Administrative measures, Policy rules distinctions</li>
                                <li>Appealable orders (8:1, 7:1, 8:3, 1:2)</li>
                                <li>Interested party (direct vs indirect)</li>
                                <li>Preliminary procedure requirements</li>
                                <li>Sanctions: Coercive action vs Administrative fines</li>
                            </ul>

                            <h3>Week 4 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Criminal Trial Decision Model (Arts 348-350 CCP)</li>
                                <li>Writ of summons requirements (Art. 261 CCP)</li>
                                <li>Court competence (absolute vs relative)</li>
                                <li>Prosecution Service admissibility</li>
                                <li>Requirements of criminal liability</li>
                            </ul>

                            <h3>Week 5 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>Obligations definition and Roman law classification</li>
                                <li>How obligations end</li>
                                <li>Validity of contract (3:32, 3:40, 6:217)</li>
                            </ul>

                            <h3>Week 6 Focus:</h3>
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li>ICJ jurisdiction (Art. 36 ICJ Statute)</li>
                                <li>Sources court will apply (Art. 38 SICJ)</li>
                                <li>Opinio iuris and usus</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Practice Section -->
            <div id="practice" class="section">
                <h1>âœï¸ Practice Questions</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Test your knowledge with interactive practice questions</p>

                <div class="practice-modes">
                    <div class="practice-card" onclick="startPractice('multiple-choice')">
                        <div class="practice-icon">ðŸ“</div>
                        <h3>Multiple Choice Questions</h3>
                        <p>Quick quiz format covering all topics</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 1rem;">50+ Questions Available</p>
                    </div>

                    <div class="practice-card" onclick="startPractice('case-analysis')">
                        <div class="practice-icon">âš–ï¸</div>
                        <h3>Case Analysis</h3>
                        <p>Practice analyzing legal scenarios</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 1rem;">20+ Scenarios</p>
                    </div>

                    <div class="practice-card" onclick="startPractice('decision-models')">
                        <div class="practice-icon">ðŸ”„</div>
                        <h3>Decision Models</h3>
                        <p>Interactive criminal & administrative law flows</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 1rem;">Interactive Tools</p>
                    </div>

                    <div class="practice-card" onclick="startPractice('article-lookup')">
                        <div class="practice-icon">ðŸ“–</div>
                        <h3>Article Lookup Practice</h3>
                        <p>Speed practice finding articles</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 1rem;">Timed Challenges</p>
                    </div>

                    <div class="practice-card" onclick="startPractice('ai-assessment')">
                        <div class="practice-icon">ðŸ¤–</div>
                        <h3>AI Assessment</h3>
                        <p>Get detailed feedback on your answers</p>
                        <p style="color: var(--warning); font-weight: bold; margin-top: 1rem;">Requires Backend Setup</p>
                    </div>

                    <div class="practice-card" onclick="startPractice('flashcards')">
                        <div class="practice-icon">ðŸŽ´</div>
                        <h3>Flashcards</h3>
                        <p>Memorize key definitions and principles</p>
                        <p style="color: var(--success); font-weight: bold; margin-top: 1rem;">100+ Cards</p>
                    </div>
                </div>

                <div id="practice-area" style="margin-top: 3rem; display: none;">
                    <!-- Practice content will be loaded here -->
                </div>
            </div>

            <!-- Mock Exam Section -->
            <div id="mock-exam" class="section">
                <h1>ðŸ“ Mock Examination</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Full exam simulation with AI grading</p>

                <div class="alert alert-warning">
                    <strong>â±ï¸ Exam Conditions:</strong> This mock exam simulates real exam conditions.<br>
                    Part A (Law): 100 points | Part B (Skills): 100 points<br>
                    Pass requirement: 110/200 points total
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="startMockExam('law')">ðŸ“‹ Start Law Mock Exam</button>
                    <button class="btn btn-secondary" onclick="startMockExam('skills')">ðŸ“„ Start Skills Mock Exam</button>
                    <button class="btn btn-outline" onclick="startMockExam('full')">ðŸŽ¯ Full Mock Exam (Both Parts)</button>
                </div>

                <div id="mock-exam-content" style="margin-top: 3rem;">
                    <!-- Will be populated by loadMockResults() -->
                </div>
            </div>

            <!-- Quick Reference Section -->
            <div id="reference" class="section">
                <h1>ðŸ“– Quick Reference</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Essential definitions, principles, and article references</p>

                <div class="search-box">
                    <span class="search-icon">ðŸ”</span>
                    <input type="text" class="search-input" placeholder="Search articles, definitions, or principles..." 
                           oninput="searchReference(this.value)">
                </div>

                <div style="text-align: center; margin: 1.5rem 0;">
                    <button class="btn-ai" onclick="openAIChat('Quick Reference')">
                        ðŸ¤– Ask AI About Any Topic
                    </button>
                </div>

                <div class="sub-tabs">
                    <div class="sub-tab active" onclick="showSubContent('reference', 'definitions')">Definitions</div>
                    <div class="sub-tab" onclick="showSubContent('reference', 'articles')">Key Articles</div>
                    <div class="sub-tab" onclick="showSubContent('reference', 'principles')">Legal Principles</div>
                    <div class="sub-tab" onclick="showSubContent('reference', 'cases')">Important Cases</div>
                </div>

                <div id="reference-definitions" class="sub-content active">
                    <h2>Essential Definitions</h2>
                    <div class="reference-grid">
                        <div class="reference-item">
                            <strong>Operative Fact</strong>
                            A fact that satisfies the conditions of a legal rule, triggering legal consequences
                        </div>
                        <div class="reference-item">
                            <strong>Juridical Act</strong>
                            Intentional action to bring about specific legal consequences (e.g., contracts, wills)
                        </div>
                        <div class="reference-item">
                            <strong>Natural Person</strong>
                            A human being with legal personality
                        </div>
                        <div class="reference-item">
                            <strong>Legal Person</strong>
                            An organization recognized by law as having rights and duties
                        </div>
                        <div class="reference-item">
                            <strong>Public Law</strong>
                            Law where government "as such" plays a role
                        </div>
                        <div class="reference-item">
                            <strong>Private Law</strong>
                            Law governing relations between private parties
                        </div>
                        <div class="reference-item">
                            <strong>Substantive Law</strong>
                            Defines rights and duties
                        </div>
                        <div class="reference-item">
                            <strong>Procedural Law</strong>
                            Provides mechanisms to enforce rights
                        </div>
                        <div class="reference-item">
                            <strong>Administrative Authority</strong>
                            Organ of public law entity or body with public authority (Art. 1:1 GALA)
                        </div>
                        <div class="reference-item">
                            <strong>Order (Besluit)</strong>
                            Written decision by administrative authority constituting public law act (Art. 1:3 GALA)
                        </div>
                        <div class="reference-item">
                            <strong>Actus Reus</strong>
                            Physical act or unlawful omission constituting external component of crime
                        </div>
                        <div class="reference-item">
                            <strong>Mens Rea</strong>
                            Mental state/intent required at time of committing crime
                        </div>
                        <div class="reference-item">
                            <strong>Obligation</strong>
                            Legal relationship where creditor entitled to performance from debtor
                        </div>
                        <div class="reference-item">
                            <strong>Usus</strong>
                            Consistent state practice (element of customary international law)
                        </div>
                        <div class="reference-item">
                            <strong>Opinio Iuris</strong>
                            Belief that practice is legally required (element of customary international law)
                        </div>
                    </div>
                </div>

                <div id="reference-articles" class="sub-content">
                    <h2>Key Articles by Topic</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“œ Constitutional Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Content</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 81 C.</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Formal legislator = Parliament + Government</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 42(2) C.</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">King inviolable; ministers responsible</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 120 C.</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">No judicial review of Acts of Parliament</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 94 C.</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Self-executing treaties prevail over conflicting law</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›ï¸ Administrative Law (GALA)</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Content</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 1:1</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Definition of administrative authority</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 1:2</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Definition of interested party</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 1:3</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Definition and types of orders</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 5:1, 5:2</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Coercive action (bestuursdwang)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 7:1, 8:1</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Notice of objection requirements</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 8:70, 8:72</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Court judgment outcomes</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ Criminal Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Content</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 261 CCP</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Writ of summons requirements</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 348-349 CCP</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Preliminary questions in trial</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 350 CCP</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Fundamental questions in trial</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 9 PC</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Principal and additional penalties</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 68, 69, 70 PC</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Statute of limitations</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“ Private Law (DCC)</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Content</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 3:32</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Capacity requirement for contracts</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 3:33</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Consensus requirement</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 3:40</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Permissible content (void if contrary to public order)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 3:44</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Vitiated consent (threat, fraud, abuse, error)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:74</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Liability for non-performance (all damages begin here!)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:217</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Contract formation by offer and acceptance</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:227</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Determinability of obligations</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:228</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Error in contracts</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:248</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Reasonableness and equity</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6:265</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Dissolution/rescission of contract</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸŒ International Law</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Article</th>
                                    <th style="padding: 0.75rem; text-align: left; border: 1px solid var(--border);">Content</th>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 2 UN Charter</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Sovereign equality, prohibition of force</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 51 UN Charter</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Right to self-defense</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 36 ICJ Statute</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">ICJ jurisdiction (consensual)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 38 ICJ Statute</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Sources of international law</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 94 UN Charter</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Compliance with ICJ decisions</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);"><strong>Art. 6 ECHR</strong></td>
                                    <td style="padding: 0.75rem; border: 1px solid var(--border);">Right to fair trial</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="reference-principles" class="sub-content">
                    <h2>Legal Principles</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>âš–ï¸ Latin Maxims</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="reference-grid">
                                <div class="reference-item">
                                    <strong>Lex superior derogat legi inferiori</strong>
                                    Higher law overrides lower law
                                </div>
                                <div class="reference-item">
                                    <strong>Lex posterior derogat legi priori</strong>
                                    Newer law overrides older law
                                </div>
                                <div class="reference-item">
                                    <strong>Lex specialis derogat legi generali</strong>
                                    Specific law overrides general law
                                </div>
                                <div class="reference-item">
                                    <strong>Nulla poena sine lege</strong>
                                    No punishment without law (legality principle)
                                </div>
                                <div class="reference-item">
                                    <strong>Actus reus</strong>
                                    Guilty act (physical element of crime)
                                </div>
                                <div class="reference-item">
                                    <strong>Mens rea</strong>
                                    Guilty mind (mental element of crime)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ›ï¸ Constitutional Principles</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Trias Politica:</strong> Separation of powers (Legislative, Executive, Judicial)</li>
                                <li><strong>Legality Principle:</strong> Public bodies must act based on law</li>
                                <li><strong>Rule of Law (Rechtsstaat):</strong> Four elements: separation of powers, legality, fundamental rights, judicial review</li>
                                <li><strong>Ministerial Responsibility:</strong> Ministers accountable to Parliament, not King</li>
                                <li><strong>Parliamentary Sovereignty:</strong> (Debated in Dutch system)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“‹ Administrative Law Principles</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Principle of Speciality:</strong> Government bodies must have legal authority for specific actions</li>
                                <li><strong>Attribution vs Delegation:</strong> Power granted directly vs transferred</li>
                                <li><strong>Principles of Good Governance:</strong> Limit administrative power</li>
                                <li><strong>Legal Certainty:</strong> Protection of legitimate expectations</li>
                                <li><strong>Equality:</strong> Similar cases treated similarly</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“ Contract Law Principles</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <ul style="margin-left: 1.5rem; line-height: 2;">
                                <li><strong>Freedom of Contract:</strong> Freedom from formal requirements, choice of parties, obligations, content</li>
                                <li><strong>Haviltex Doctrine:</strong> Interpretation based on reasonable attribution and expectations</li>
                                <li><strong>Reasonableness & Equity (Art. 6:248):</strong> Supplementary and restrictive functions</li>
                                <li><strong>Pacta Sunt Servanda:</strong> Agreements must be kept</li>
                                <li><strong>Good Faith:</strong> Parties must act in good faith</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="reference-cases" class="sub-content">
                    <h2>Important Cases</h2>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸ“š Dutch Supreme Court Cases</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Haviltex (1981)</strong><br>
                                Contract interpretation based on reasonable attribution and expectations, considering circumstances, legal knowledge, and social circles.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Lindeboom v Amsterdam (1969)</strong><br>
                                Irrevocable offer binding; removes opportunity to prevent contract formation during acceptance period.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Silver Cup of Stevensweert (1960)</strong><br>
                                Guidance on regret and error after sale; extra circumstances needed for successful claims.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>DES Daughters Case</strong><br>
                                Alternative causality: each pharmaceutical producer liable for full damage when uncertain which caused harm. Victim protection prioritized.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Harmonisatiewet Arrest (1989)</strong><br>
                                Supreme Court confirmed prohibition of judicial constitutional review (Art. 120).
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>ðŸŒ ECtHR Cases</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content">
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>OsmanoÄŸlu and KocabaÅŸ v. Switzerland</strong><br>
                                Religious freedom (Art. 9) vs compulsory swimming lessons. State's interference justified within margin of appreciation for education regulation.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Metropolitan Church of Bessarabia v. Moldova</strong><br>
                                Freedom of religion case demonstrating Art. 9 ECHR protections.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Namazov v. Azerbaijan</strong><br>
                                Fair trial and procedural rights under Art. 6 ECHR.
                            </div>
                            <div class="reference-item" style="margin-bottom: 1rem;">
                                <strong>Catt v. United Kingdom</strong><br>
                                Privacy rights and data retention under Art. 8 ECHR.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Legal Tools Section -->
            <div id="tools" class="section">
                <h1>ðŸ› ï¸ Legal Tools & Decision Models</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Interactive tools to help you apply legal frameworks</p>

                <div class="practice-modes">
                    <div class="practice-card" onclick="showTool('criminal-decision')">
                        <div class="practice-icon">âš–ï¸</div>
                        <h3>Criminal Law Decision Model</h3>
                        <p>Interactive Arts. 348-350 CCP flowchart</p>
                    </div>

                    <div class="practice-card" onclick="showTool('admin-decision')">
                        <div class="practice-icon">ðŸ“‹</div>
                        <h3>Administrative Law Checker</h3>
                        <p>GALA legal protection requirements</p>
                    </div>

                    <div class="practice-card" onclick="showTool('contract-validity')">
                        <div class="practice-icon">ðŸ“</div>
                        <h3>Contract Validity Checker</h3>
                        <p>Four requirements assessment tool</p>
                    </div>

                    <div class="practice-card" onclick="showTool('article-finder')">
                        <div class="practice-icon">ðŸ”</div>
                        <h3>Smart Article Finder</h3>
                        <p>Quick lookup by topic or keyword</p>
                    </div>

                    <div class="practice-card" onclick="showTool('case-analyzer')">
                        <div class="practice-icon">ðŸŽ¯</div>
                        <h3>Case Fact Analyzer</h3>
                        <p>Identify operative facts and legal consequences</p>
                    </div>

                    <div class="practice-card" onclick="showTool('hierarchy')">
                        <div class="practice-icon">ðŸ“Š</div>
                        <h3>Legal Hierarchy Visualizer</h3>
                        <p>Interactive hierarchy of laws</p>
                    </div>
                </div>

                <div id="tool-area" style="margin-top: 3rem; display: none;">
                    <!-- Tool content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            // Load mock results when showing mock exam section
            if (sectionId === 'mock-exam') {
                loadMockResults();
            }
        }

        function showSubContent(parentId, subId) {
            const parent = parentId;
            document.querySelectorAll(`#${parent} .sub-tab`).forEach(t => t.classList.remove('active'));
            document.querySelectorAll(`#${parent} .sub-content`).forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${parent}-${subId}`).classList.add('active');
        }

        // Accordion
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.accordion-icon');
            
            content.classList.toggle('active');
            icon.classList.toggle('rotated');
        }

        // Quiz System
        let currentQuizQuestion = 0;
        let quizScore = 0;
        let quizAnswered = false;

        const quizQuestions = [
            {
                question: "Which court in the Netherlands handles cases in cassation (reviewing only questions of law)?",
                options: [
                    "A) District Court (Rechtbank)",
                    "B) Court of Appeal (Gerechtshof)",
                    "C) Supreme Court (Hoge Raad)",
                    "D) Constitutional Court"
                ],
                correct: "C",
                explanation: "The Supreme Court (Hoge Raad) handles cassation proceedings, reviewing only questions of law, not facts (3rd instance)."
            },
            {
                question: "According to Art. 1:3 GALA, which type of order is NOT appealable to administrative court?",
                options: [
                    "A) Administrative decision (beschikking)",
                    "B) General Binding Regulation (GBR)",
                    "C) Administrative measure",
                    "D) Rejection of application"
                ],
                correct: "B",
                explanation: "GBRs (General Binding Regulations) are orders of general nature and are NOT directly appealable. Only administrative decisions and measures can be appealed."
            },
            {
                question: "Which principle states 'specific law prevails over general law'?",
                options: [
                    "A) Lex superior derogat legi inferiori",
                    "B) Lex posterior derogat legi priori",
                    "C) Lex specialis derogat legi generali",
                    "D) Nulla poena sine lege"
                ],
                correct: "C",
                explanation: "Lex specialis derogat legi generali means specific law overrides general law. This is important in the layered structure of the Dutch Civil Code."
            },
            {
                question: "All damages in contract law begin with which article of the DCC?",
                options: [
                    "A) Art. 3:40 DCC",
                    "B) Art. 6:74 DCC",
                    "C) Art. 6:248 DCC",
                    "D) Art. 6:265 DCC"
                ],
                correct: "B",
                explanation: "Art. 6:74 DCC is the foundation for all damages: 'Every failure in performance obliges the debtor to repair damage, unless failure cannot be imputed to debtor.'"
            },
            {
                question: "Which is NOT one of the four requirements for criminal liability?",
                options: [
                    "A) Human conduct (actus reus)",
                    "B) Statutory offence",
                    "C) Unlawfulness",
                    "D) Proportionality of sentence"
                ],
                correct: "D",
                explanation: "The four requirements are: (1) Human conduct, (2) Statutory offence, (3) Unlawfulness, (4) Guilt/Blameworthiness. Proportionality relates to sentencing, not liability."
            },
            {
                question: "Under Art. 120 of the Dutch Constitution, can courts review Acts of Parliament for constitutionality?",
                options: [
                    "A) Yes, always",
                    "B) Yes, but only the Supreme Court",
                    "C) No, this is prohibited",
                    "D) Yes, but only for fundamental rights"
                ],
                correct: "C",
                explanation: "Art. 120 prohibits judicial review of Acts of Parliament for constitutionality. However, Art. 94 allows review based on self-executing treaties."
            },
            {
                question: "What are the TWO elements required for customary international law?",
                options: [
                    "A) Usus and opinio iuris",
                    "B) Treaty and consent",
                    "C) Practice and enforcement",
                    "D) Recognition and ratification"
                ],
                correct: "A",
                explanation: "Customary international law requires: (1) Usus (consistent state practice) and (2) Opinio iuris (belief that practice is legally required)."
            },
            {
                question: "The Haviltex doctrine applies to which area of law?",
                options: [
                    "A) Criminal law interpretation",
                    "B) Contract interpretation",
                    "C) Constitutional interpretation",
                    "D) Treaty interpretation"
                ],
                correct: "B",
                explanation: "Haviltex (1981) establishes that contract interpretation is based on what parties could reasonably attribute to clauses considering their circumstances and expectations."
            },
            {
                question: "Which article defines an 'interested party' under GALA?",
                options: [
                    "A) Art. 1:1 GALA",
                    "B) Art. 1:2 GALA",
                    "C) Art. 1:3 GALA",
                    "D) Art. 7:1 GALA"
                ],
                correct: "B",
                explanation: "Art. 1:2 GALA defines interested parties as those directly affected by a decision or third parties with personal, objective, current interest causally connected to the decision."
            },
            {
                question: "In the Criminal Trial Decision Model, what happens if the indictment CANNOT be proven?",
                options: [
                    "A) Dismissal of charges",
                    "B) Acquittal",
                    "C) Move to next question anyway",
                    "D) Inadmissible prosecution"
                ],
                correct: "B",
                explanation: "If the indictment cannot be proven (Fundamental Question 1, Art. 350 CCP), the defendant is acquitted. The court cannot proceed to the other questions."
            }
        ];

        // Week Cards Data
        const weeksData = [
            {
                number: 1,
                title: "Introduction to Dutch Law",
                topics: ["Taekema - Understanding Dutch Law", "Hage - Basic Concepts", "Sources of Law", "Court Structure"],
                status: "complete"
            },
            {
                number: 2,
                title: "Constitutional Law",
                topics: ["Rule of Law (Rechtsstaat)", "Trias Politica", "Fundamental Rights", "Judicial Review"],
                status: "complete"
            },
            {
                number: 3,
                title: "Administrative Law",
                topics: ["GALA Overview", "Administrative Authorities", "Types of Orders", "Legal Protection"],
                status: "progress"
            },
            {
                number: 4,
                title: "Criminal Law",
                topics: ["Criminal Liability", "Intent & Negligence", "Defences", "Decision Model"],
                status: "progress"
            },
            {
                number: 5,
                title: "Private Law",
                topics: ["Contract Formation", "Vitiated Consent", "Breach & Remedies", "Haviltex Doctrine"],
                status: "pending"
            },
            {
                number: 6,
                title: "International Law",
                topics: ["Sources of Int'l Law", "United Nations", "ICJ", "ECHR"],
                status: "pending"
            },
            {
                number: 7,
                title: "Exam Preparation",
                topics: ["Exam Strategy", "Key Topics Review", "Mock Exams", "Final Tips"],
                status: "pending"
            }
        ];

        // Initialize Dashboard
        function initializeDashboard() {
            const weeksContainer = document.getElementById('weeks-overview');
            
            weeksData.forEach(week => {
                const statusClass = week.status === 'complete' ? 'status-complete' : 
                                  week.status === 'progress' ? 'status-progress' : 'status-pending';
                const statusText = week.status === 'complete' ? 'âœ“ Complete' : 
                                 week.status === 'progress' ? 'â³ In Progress' : 'â—‹ Pending';
                const cardClass = week.status === 'complete' ? 'week-card completed' : 'week-card';
                
                const card = document.createElement('div');
                card.className = cardClass;
                card.innerHTML = `
                    <div class="week-header">
                        <div class="week-number">Week ${week.number}</div>
                        <div class="week-status ${statusClass}">${statusText}</div>
                    </div>
                    <h3>${week.title}</h3>
                    <div class="week-topics">
                        ${week.topics.map(topic => `
                            <div class="topic-item">
                                <input type="checkbox" class="topic-checkbox" ${week.status === 'complete' ? 'checked' : ''}>
                                <span>${topic}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                weeksContainer.appendChild(card);
            });

            // Calculate progress
            const completedWeeks = weeksData.filter(w => w.status === 'complete').length;
            const progressPercent = Math.round((completedWeeks / weeksData.length) * 100);
            
            document.getElementById('completion-rate').textContent = `${progressPercent}%`;
            document.getElementById('overall-progress').style.width = `${progressPercent}%`;
            document.getElementById('overall-progress').textContent = `${progressPercent}%`;
        }

        // Practice Functions
        function startPractice(mode) {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.style.display = 'block';
            
            switch(mode) {
                case 'multiple-choice':
                    loadMultipleChoice();
                    break;
                case 'case-analysis':
                    loadCaseAnalysis();
                    break;
                case 'decision-models':
                    loadDecisionModels();
                    break;
                case 'article-lookup':
                    loadArticleLookup();
                    break;
                case 'ai-assessment':
                    loadAIAssessment();
                    break;
                case 'flashcards':
                    loadFlashcards();
                    break;
            }
            
            practiceArea.scrollIntoView({ behavior: 'smooth' });
        }

        function loadMultipleChoice() {
            currentQuizQuestion = 0;
            quizScore = 0;
            quizAnswered = false;
            displayQuizQuestion();
        }

        function displayQuizQuestion() {
            const practiceArea = document.getElementById('practice-area');
            const q = quizQuestions[currentQuizQuestion];
            
            practiceArea.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Multiple Choice Practice</h2>
                    <div style="background: var(--primary); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: bold;">
                        Score: ${quizScore}/${currentQuizQuestion}
                    </div>
                </div>
                <div class="quiz-container">
                    <div class="question-card">
                        <div class="question-number">Question ${currentQuizQuestion + 1} of ${quizQuestions.length}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options" id="quiz-options">
                            ${q.options.map((option, idx) => `
                                <div class="option" onclick="selectQuizOption(this, '${String.fromCharCode(65 + idx)}')">
                                    <input type="radio" name="quiz-q" value="${String.fromCharCode(65 + idx)}">
                                    <label>${option}</label>
                                </div>
                            `).join('')}
                        </div>
                        <div id="quiz-feedback" style="margin-top: 1.5rem; display: none;"></div>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="check-answer-btn" onclick="checkQuizAnswer()">Check Answer</button>
                        <button class="btn btn-secondary" id="next-question-btn" onclick="nextQuizQuestion()" style="display: none;">Next Question â†’</button>
                        <button class="btn btn-outline" onclick="restartQuiz()">Restart Quiz</button>
                    </div>
                </div>
            `;
            practiceArea.style.display = 'block';
            quizAnswered = false;
        }

        function selectQuizOption(element, value) {
            if (quizAnswered) return; // Don't allow changing after answer is checked
            
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }

        function checkQuizAnswer() {
            if (quizAnswered) return;
            
            const selected = document.querySelector('.option.selected');
            if (!selected) {
                alert('Please select an answer first!');
                return;
            }
            
            const selectedValue = selected.querySelector('input').value;
            const q = quizQuestions[currentQuizQuestion];
            const allOptions = document.querySelectorAll('.option');
            const isCorrect = selectedValue === q.correct;
            
            // Mark answers
            allOptions.forEach(opt => {
                const value = opt.querySelector('input').value;
                if (value === q.correct) {
                    opt.classList.add('correct');
                } else if (opt.classList.contains('selected')) {
                    opt.classList.add('incorrect');
                }
                opt.style.pointerEvents = 'none'; // Disable further clicking
            });
            
            // Update score
            if (isCorrect) {
                quizScore++;
            }
            
            // Show feedback
            const feedback = document.getElementById('quiz-feedback');
            feedback.style.display = 'block';
            feedback.innerHTML = `
                <div class="alert ${isCorrect ? 'alert-success' : 'alert-danger'}">
                    <strong>${isCorrect ? 'âœ“ Correct!' : 'âœ— Incorrect'}</strong><br>
                    ${q.explanation}
                </div>
            `;
            
            // Update buttons
            document.getElementById('check-answer-btn').style.display = 'none';
            document.getElementById('next-question-btn').style.display = 'inline-block';
            
            quizAnswered = true;
            
            // Update practice count in localStorage
            const practiceCount = parseInt(localStorage.getItem('lls-practice-count') || '0');
            localStorage.setItem('lls-practice-count', practiceCount + 1);
            document.getElementById('practice-count').textContent = practiceCount + 1;
        }

        function nextQuizQuestion() {
            currentQuizQuestion++;
            
            if (currentQuizQuestion >= quizQuestions.length) {
                showQuizResults();
            } else {
                displayQuizQuestion();
            }
        }

        function showQuizResults() {
            const practiceArea = document.getElementById('practice-area');
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);
            const passed = percentage >= 55; // 55% passing grade like exam
            
            practiceArea.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <h2>ðŸŽ‰ Quiz Complete!</h2>
                    <div class="grade-display" style="color: ${passed ? 'var(--success)' : 'var(--danger)'};">
                        ${quizScore}/${quizQuestions.length}
                    </div>
                    <div style="font-size: 2rem; margin: 1rem 0;">
                        ${percentage}%
                    </div>
                    <div class="alert ${passed ? 'alert-success' : 'alert-warning'}">
                        <strong>${passed ? 'âœ“ Passed!' : 'âš ï¸ Keep Practicing'}</strong><br>
                        ${passed ? 'Great job! You\'re ready for more challenging questions.' : 'Review the topics you missed and try again.'}
                    </div>
                    <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="restartQuiz()">Take Quiz Again</button>
                        <button class="btn btn-secondary" onclick="startPractice('case-analysis')">Try Case Analysis</button>
                        <button class="btn btn-outline" onclick="showSection('study')">Review Study Materials</button>
                    </div>
                </div>
            `;
        }

        function restartQuiz() {
            loadMultipleChoice();
        }

        function loadCaseAnalysis() {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.innerHTML = `
                <h2>Case Analysis Practice</h2>
                <div class="alert alert-warning">
                    Read the scenario carefully and identify the operative facts, relevant legal provisions, and potential legal consequences.
                </div>
                <div class="question-card">
                    <h3>Scenario: The Ikea Pricing Error</h3>
                    <p style="line-height: 1.8; margin-top: 1rem;">
                        Daan saw an Ikea advertisement offering a bunk bed set for â‚¬24.00 (normally â‚¬240). He immediately ordered it online. 
                        After the weekend, Ikea emailed saying it was a system error - the bed was listed at only the mattress price. 
                        Ikea refuses to deliver and will refund the payment. Daan believes a contract exists and Ikea must deliver at â‚¬24.00.
                    </p>
                    
                    <div class="form-group" style="margin-top: 2rem;">
                        <label class="form-label">1. Test the Four Requirements for Contract Validity:</label>
                        <textarea class="form-textarea" id="case-q1" placeholder="Analyze: Capacity (3:32), Permissibility (3:40), Consensus (3:33), Determinability (6:227)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">2. Apply Article 3:35 DCC (Will-Reliance Doctrine):</label>
                        <textarea class="form-textarea" id="case-q2" placeholder="Could Daan reasonably interpret the price as intended?"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">3. Conclusion - Is Daan's Claim Valid?</label>
                        <textarea class="form-textarea" id="case-q3" placeholder="Your reasoned conclusion with article references"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                        <button class="btn btn-secondary" onclick="assessCaseAnalysis()">ðŸ“Š Assess My Answer</button>
                        <button class="btn btn-outline" onclick="showModelAnswer()">ðŸ“– View Model Answer</button>
                        <button class="btn btn-outline" onclick="loadNextCase()">Next Case â†’</button>
                    </div>
                    
                    <div id="case-assessment" style="margin-top: 2rem; display: none;"></div>
                </div>
            `;
        }

        function assessCaseAnalysis() {
            const q1 = document.getElementById('case-q1').value.trim();
            const q2 = document.getElementById('case-q2').value.trim();
            const q3 = document.getElementById('case-q3').value.trim();
            
            if (!q1 || !q2 || !q3) {
                alert('Please answer all three parts before assessment!');
                return;
            }
            
            // Simple keyword-based assessment (in real version would use AI)
            let score = 0;
            let feedback = [];
            
            // Check Q1 for key terms
            const q1Keywords = ['3:32', 'capacity', '3:40', 'permissible', '3:33', 'consensus', '6:227', 'determinability'];
            const q1Found = q1Keywords.filter(kw => q1.toLowerCase().includes(kw.toLowerCase()));
            const q1Score = Math.min(10, Math.floor((q1Found.length / q1Keywords.length) * 10));
            score += q1Score;
            
            if (q1Score >= 7) {
                feedback.push('âœ“ <strong>Q1:</strong> Good coverage of the four requirements');
            } else {
                feedback.push('âš ï¸ <strong>Q1:</strong> Make sure to mention all four requirements with article numbers: 3:32, 3:40, 3:33, 6:227');
            }
            
            // Check Q2 for reasoning
            const q2Keywords = ['3:35', 'reasonable', 'price', 'error', 'duty to investigate'];
            const q2Found = q2Keywords.filter(kw => q2.toLowerCase().includes(kw.toLowerCase()));
            const q2Score = Math.min(10, Math.floor((q2Found.length / q2Keywords.length) * 10));
            score += q2Score;
            
            if (q2Score >= 7) {
                feedback.push('âœ“ <strong>Q2:</strong> Good application of Art. 3:35');
            } else {
                feedback.push('âš ï¸ <strong>Q2:</strong> Remember to discuss whether Daan could <em>reasonably</em> believe the price was intended');
            }
            
            // Check Q3 for conclusion
            const q3Keywords = ['not valid', 'no contract', 'no consensus', 'ikea'];
            const q3Found = q3Keywords.filter(kw => q3.toLowerCase().includes(kw.toLowerCase()));
            const q3Score = Math.min(10, Math.floor((q3Found.length / q3Keywords.length) * 10));
            score += q3Score;
            
            if (q3Score >= 7) {
                feedback.push('âœ“ <strong>Q3:</strong> Clear conclusion with reasoning');
            } else {
                feedback.push('âš ï¸ <strong>Q3:</strong> Make sure your conclusion is clear and supported by your analysis');
            }
            
            const totalScore = Math.round(score / 3);
            const passed = totalScore >= 6;
            
            const assessmentDiv = document.getElementById('case-assessment');
            assessmentDiv.style.display = 'block';
            assessmentDiv.innerHTML = `
                <div class="assessment-result">
                    <h3>Assessment Results</h3>
                    <div class="grade-display" style="color: ${passed ? 'var(--success)' : 'var(--warning)'};">
                        ${totalScore}/10
                    </div>
                    <div class="alert ${passed ? 'alert-success' : 'alert-warning'}">
                        <strong>${passed ? 'âœ“ Good Work!' : 'âš ï¸ Keep Practicing'}</strong><br>
                        ${passed ? 'Your analysis shows good understanding of contract law.' : 'Review the model answer and focus on article citations.'}
                    </div>
                    <div class="feedback-section">
                        <h4>Feedback:</h4>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            ${feedback.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="alert alert-warning" style="margin-top: 1rem;">
                        <strong>ðŸ’¡ Tip:</strong> This is a simplified keyword-based assessment. For detailed AI-powered feedback, set up the backend server (see BACKEND_SETUP.md).
                    </div>
                </div>
            `;
            
            assessmentDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showModelAnswer() {
            const assessmentDiv = document.getElementById('case-assessment');
            assessmentDiv.style.display = 'block';
            assessmentDiv.innerHTML = `
                <div class="assessment-result">
                    <h3>ðŸ“– Model Answer</h3>
                    
                    <div class="feedback-section">
                        <h4>1. Four Requirements for Contract Validity:</h4>
                        <p style="line-height: 1.8;">
                            <strong>Capacity (Art. 3:32 DCC):</strong> Yes - Both Daan and Ikea are capable parties.<br><br>
                            <strong>Permissible Content (Art. 3:40 DCC):</strong> Yes - Buying furniture is lawful and not contrary to public order.<br><br>
                            <strong>Consensus (Art. 3:33 DCC):</strong> This is the problematic requirement. While Daan accepted the offer, 
                            there is a mismatch between Ikea's intention (â‚¬240) and their declaration (â‚¬24).<br><br>
                            <strong>Determinability (Art. 6:227 DCC):</strong> Yes - The obligations are clear (deliver bed set, pay price).
                        </p>
                        
                        <h4 style="margin-top: 1.5rem;">2. Application of Art. 3:35 DCC:</h4>
                        <p style="line-height: 1.8;">
                            Art. 3:35 DCC states that "absence of intention in a declaration cannot be invoked against a person who has 
                            interpreted another's declaration in conformity with the sense which he could reasonably attribute to it."
                            <br><br>
                            However, Daan could NOT reasonably believe â‚¬24 was the intended price because:
                            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>The price is significantly lower than market value (90% discount)</li>
                                <li>The advertisement mentioned it was only the mattress price</li>
                                <li>Daan has a duty to investigate obvious pricing errors</li>
                            </ul>
                        </p>
                        
                        <h4 style="margin-top: 1.5rem;">3. Conclusion:</h4>
                        <p style="line-height: 1.8;">
                            <strong>Daan is NOT correct.</strong> The contract is likely not valid due to lack of genuine consensus (Art. 3:33 DCC). 
                            The price discrepancy is so significant that Daan could not reasonably believe â‚¬24 was Ikea's intended price 
                            (Art. 3:35 DCC). Therefore, Ikea can successfully argue that no binding contract was formed, and they are not 
                            obligated to deliver at the erroneous price.
                        </p>
                    </div>
                    
                    <div class="alert alert-success" style="margin-top: 1rem;">
                        <strong>ðŸ’¡ Key Takeaways:</strong>
                        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>Always test all four requirements systematically</li>
                            <li>Art. 3:35 protects reasonable reliance, not unreasonable expectations</li>
                            <li>Obvious errors create a duty to investigate</li>
                            <li>Always cite specific articles</li>
                        </ul>
                    </div>
                </div>
            `;
            assessmentDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function loadNextCase() {
            alert('ðŸŽ¯ More case scenarios coming soon! For now, try the other practice modes or review study materials.');
        }

        function loadDecisionModels() {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.innerHTML = `
                <h2>Interactive Decision Models</h2>
                <div class="sub-tabs">
                    <div class="sub-tab active" onclick="showSubContent('practice', 'criminal-model')">Criminal Law (Arts 348-350 CCP)</div>
                    <div class="sub-tab" onclick="showSubContent('practice', 'admin-model')">Administrative Law (GALA)</div>
                </div>
                
                <div id="practice-criminal-model" class="sub-content active">
                    <h3 style="margin-top: 2rem;">Criminal Trial Decision Model</h3>
                    <div class="decision-tree">
                        <div class="decision-node">
                            <div class="decision-question">Preliminary Question 1: Is the writ of summons valid? (Art. 261 CCP)</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Continue</button>
                                <button class="btn btn-outline">âœ— No - Inadmissible</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">Preliminary Question 2: Is the court competent?</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Continue</button>
                                <button class="btn btn-outline">âœ— No - Inadmissible</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">Preliminary Question 3: Is prosecution admissible?</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Continue</button>
                                <button class="btn btn-outline">âœ— No - Inadmissible</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">Fundamental Question 1: Can the indictment be proven? (Art. 350 CCP)</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Continue to Q2</button>
                                <button class="btn btn-outline">âœ— No - Acquittal</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">Fundamental Question 2: Do facts constitute statutory offence?</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Continue to Q3</button>
                                <button class="btn btn-outline">âœ— No - Dismissal</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">Fundamental Question 3: Is defendant punishable?</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Determine Sanction</button>
                                <button class="btn btn-outline">âœ— No - Dismissal</button>
                            </div>
                        </div>
                        <div class="decision-node" style="background: var(--success); color: white; border-color: var(--success);">
                            <div class="decision-question">Fundamental Question 4: Which sanction? (Art. 9 PC)</div>
                            <p style="margin-top: 0.5rem;">Principal penalties: Imprisonment, Community Service, Fine</p>
                        </div>
                    </div>
                </div>
                
                <div id="practice-admin-model" class="sub-content">
                    <h3 style="margin-top: 2rem;">Administrative Law Legal Protection Test</h3>
                    <p>Check if you can appeal an administrative decision:</p>
                    <div class="decision-tree">
                        <div class="decision-node">
                            <div class="decision-question">1. Is there a contestable order? (Art. 8:1, 7:1, 8:3 GALA)</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Administrative decision or measure</button>
                                <button class="btn btn-outline">âœ— No - GBR or policy rule (not appealable)</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">2. Are you an interested party? (Art. 1:2 GALA)</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Direct - Addressee of order</button>
                                <button class="btn btn-outline">âœ“ Third party - Personal, objective, current, causal interest</button>
                                <button class="btn btn-outline">âœ— No interest</button>
                            </div>
                        </div>
                        <div class="decision-node">
                            <div class="decision-question">3. Did you complete preliminary procedure? (Art. 7:1, 8:1 GALA)</div>
                            <div class="decision-options">
                                <button class="btn btn-outline">âœ“ Yes - Notice of objection filed</button>
                                <button class="btn btn-outline">âœ— No - Must file bezwaarschrift first</button>
                            </div>
                        </div>
                        <div class="decision-node" style="background: var(--success); color: white; border-color: var(--success);">
                            <div class="decision-question">âœ“ You can appeal to Administrative Court!</div>
                            <p style="margin-top: 0.5rem;">File appeal within deadline to District Court (Administrative Law Section)</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadArticleLookup() {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.innerHTML = `
                <h2>â±ï¸ Article Lookup Speed Practice</h2>
                <div class="alert alert-warning">
                    Practice finding articles quickly - essential exam skill! Timer starts when you click "Start Challenge"
                </div>
                <div style="text-align: center; margin: 2rem 0;">
                    <div id="article-timer-display" style="font-size: 3rem; font-weight: bold; color: var(--primary); margin: 1rem 0; display: none;">
                        00:00
                    </div>
                    <button class="btn btn-primary" id="start-article-btn" onclick="startArticleChallenge()">â±ï¸ Start Challenge</button>
                </div>
                <div id="article-challenge" style="display: none;">
                    <div class="question-card">
                        <h3>Find this article:</h3>
                        <p id="article-question" style="font-size: 1.2rem; margin: 1rem 0; font-weight: bold;"></p>
                        <div class="form-group">
                            <input type="text" class="form-input" placeholder="Enter article number (e.g., 3:32 or Art. 3:32 DCC)" id="article-answer">
                        </div>
                        <button class="btn btn-secondary" onclick="checkArticleAnswer()">âœ“ Submit Answer</button>
                    </div>
                    <div id="article-feedback" style="margin-top: 2rem; display: none;"></div>
                </div>
            `;
        }

        const articleChallenges = [
            { question: "Which DCC article defines the capacity requirement for contracts?", answer: "3:32", topic: "Contract Law" },
            { question: "Which article states that higher law overrides lower law?", answer: "none", explanation: "This is the principle 'Lex superior derogat legi inferiori' - not a specific article", topic: "Legal Principles" },
            { question: "Which GALA article defines 'administrative authority'?", answer: "1:1", topic: "Administrative Law" },
            { question: "Which article prohibits judicial review of Acts of Parliament?", answer: "120", explanation: "Art. 120 Constitution", topic: "Constitutional Law" },
            { question: "Which DCC article is the foundation for ALL damages in contract law?", answer: "6:74", topic: "Contract Law" },
            { question: "Which CCP articles cover the preliminary questions in criminal trials?", answer: "348", explanation: "Arts. 348-349 CCP", topic: "Criminal Law" },
            { question: "Which GALA article defines the types of orders?", answer: "1:3", topic: "Administrative Law" },
            { question: "Which article allows self-executing treaties to override national law?", answer: "94", explanation: "Art. 94 Constitution", topic: "Constitutional Law" }
        ];

        let currentArticleChallenge = 0;
        let articleStartTime;
        let articleTimerInterval;

        function startArticleChallenge() {
            currentArticleChallenge = Math.floor(Math.random() * articleChallenges.length);
            document.getElementById('article-challenge').style.display = 'block';
            document.getElementById('start-article-btn').style.display = 'none';
            document.getElementById('article-timer-display').style.display = 'block';
            document.getElementById('article-feedback').style.display = 'none';
            
            const challenge = articleChallenges[currentArticleChallenge];
            document.getElementById('article-question').textContent = challenge.question;
            document.getElementById('article-answer').value = '';
            
            // Start timer
            articleStartTime = Date.now();
            let seconds = 0;
            const display = document.getElementById('article-timer-display');
            
            articleTimerInterval = setInterval(() => {
                seconds = Math.floor((Date.now() - articleStartTime) / 1000);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                display.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 100);
        }

        function checkArticleAnswer() {
            clearInterval(articleTimerInterval);
            const timeElapsed = Math.floor((Date.now() - articleStartTime) / 1000);
            const answer = document.getElementById('article-answer').value.trim().toLowerCase();
            const challenge = articleChallenges[currentArticleChallenge];
            
            // Normalize answer (remove "art.", "dcc", spaces, etc.)
            const normalizedAnswer = answer.replace(/[^0-9:]/g, '');
            const normalizedCorrect = challenge.answer.replace(/[^0-9:]/g, '');
            
            const isCorrect = normalizedAnswer === normalizedCorrect || 
                             (challenge.answer === 'none' && (answer.includes('none') || answer.includes('not') || answer.includes('principle')));
            
            const feedbackDiv = document.getElementById('article-feedback');
            feedbackDiv.style.display = 'block';
            
            let speedRating = '';
            if (timeElapsed < 10) speedRating = 'âš¡ Lightning fast!';
            else if (timeElapsed < 20) speedRating = 'âœ“ Good speed!';
            else if (timeElapsed < 30) speedRating = 'ðŸ‘ Decent time';
            else speedRating = 'â±ï¸ Practice more for better speed';
            
            feedbackDiv.innerHTML = `
                <div class="assessment-result">
                    <div class="alert ${isCorrect ? 'alert-success' : 'alert-danger'}">
                        <strong>${isCorrect ? 'âœ“ Correct!' : 'âœ— Incorrect'}</strong><br>
                        Time: ${timeElapsed} seconds - ${speedRating}
                    </div>
                    <div class="feedback-section">
                        <h4>Answer:</h4>
                        <p style="font-size: 1.1rem;">
                            <strong>${challenge.answer === 'none' ? challenge.explanation : 'Article ' + challenge.answer}</strong><br>
                            ${challenge.explanation || ''}
                        </p>
                        <p style="margin-top: 1rem;">
                            <strong>Topic:</strong> ${challenge.topic}
                        </p>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="startArticleChallenge()">Next Challenge</button>
                        <button class="btn btn-outline" onclick="loadArticleLookup()">Reset</button>
                    </div>
                </div>
            `;
        }

        function loadAIAssessment() {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.innerHTML = `
                <h2>ðŸ¤– AI Assessment & Grading</h2>
                <div class="alert alert-success">
                    <strong>âœ¨ AI-Powered Grading:</strong> Get detailed feedback and grades on your answers from Claude Sonnet 4!
                </div>
                <div class="form-group">
                    <label class="form-label">Select Topic:</label>
                    <select class="form-select" id="assessment-topic">
                        <option>Constitutional Law</option>
                        <option>Administrative Law</option>
                        <option>Criminal Law</option>
                        <option>Private Law</option>
                        <option>International Law</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Question/Prompt (optional):</label>
                    <input type="text" class="form-input" id="assessment-question" placeholder="e.g., Analyze this contract case, Explain GALA appeals...">
                </div>
                <div class="form-group">
                    <label class="form-label">Your Answer:</label>
                    <textarea class="form-textarea" id="assessment-answer" placeholder="Write your answer here..." style="min-height: 200px;"></textarea>
                </div>
                <button class="btn btn-primary" onclick="submitAssessment()">ðŸ¤– Get AI Assessment & Grade</button>
                
                <div id="assessment-result" style="margin-top: 2rem;"></div>
            `;
        }

        function loadFlashcards() {
            const practiceArea = document.getElementById('practice-area');
            practiceArea.innerHTML = `
                <h2>ðŸŽ´ Flashcards</h2>
                <div style="text-align: center;">
                    <div class="question-card" style="min-height: 300px; display: flex; flex-direction: column; justify-content: center; cursor: pointer;" onclick="flipCard(this)">
                        <div class="flashcard-front">
                            <h3>What is the Haviltex Doctrine?</h3>
                            <p style="color: var(--text-light); margin-top: 1rem;">Click to reveal answer</p>
                        </div>
                        <div class="flashcard-back" style="display: none;">
                            <p style="line-height: 1.8;">
                                Contract interpretation based on what parties could reasonably attribute to the contract 
                                and what they could reasonably expect from each other, considering their circumstances, 
                                expectations, legal knowledge, and social circles.
                            </p>
                            <p style="color: var(--text-light); margin-top: 1rem;">Click to flip back</p>
                        </div>
                    </div>
                    <div style="margin-top: 2rem;">
                        <button class="btn btn-outline">â† Previous</button>
                        <button class="btn btn-outline" style="margin-left: 1rem;">Next â†’</button>
                    </div>
                </div>
            `;
        }

        function flipCard(card) {
            const front = card.querySelector('.flashcard-front');
            const back = card.querySelector('.flashcard-back');
            
            if (front.style.display !== 'none') {
                front.style.display = 'none';
                back.style.display = 'block';
            } else {
                front.style.display = 'block';
                back.style.display = 'none';
            }
        }

        // Mock Exam Functions
        function startMockExam(type) {
            const content = document.getElementById('mock-exam-content');
            content.innerHTML = `
                <h2>Mock Exam - ${type.toUpperCase()}</h2>
                <div class="exam-timer">
                    <div>Time Remaining</div>
                    <div class="timer-display" id="exam-timer">1:45:00</div>
                </div>
                <div class="alert alert-warning">
                    <strong>Instructions:</strong> Answer all questions. Use keywords and substantiate with article references. Write in prose, not bullet points.
                </div>
                <div class="exam-question">
                    <h3>Question 1 <span class="points">20 points</span></h3>
                    <p>Explain the four essential elements of the Rule of Law (Rechtsstaat) in the Dutch legal system. For each element, provide the relevant constitutional basis and explain its function.</p>
                    <textarea class="form-textarea" id="exam-q1" placeholder="Your answer..."></textarea>
                </div>
                <div class="exam-question">
                    <h3>Question 2 <span class="points">20 points</span></h3>
                    <p>Describe the types of orders under GALA (Art. 1:3) and explain which types are appealable to administrative court. Include the relevant articles for legal protection.</p>
                    <textarea class="form-textarea" id="exam-q2" placeholder="Your answer..."></textarea>
                </div>
                <div class="exam-question">
                    <h3>Question 3 <span class="points">20 points</span></h3>
                    <p>Using the Criminal Trial Decision Model (Arts. 348-350 CCP), explain the preliminary questions that must be answered before the fundamental questions. What happens if any preliminary question is answered negatively?</p>
                    <textarea class="form-textarea" id="exam-q3" placeholder="Your answer..."></textarea>
                </div>
                <div class="exam-question">
                    <h3>Question 4 <span class="points">20 points</span></h3>
                    <p>What are the four requirements for a valid contract under Dutch law? Provide the relevant articles and explain each requirement.</p>
                    <textarea class="form-textarea" id="exam-q4" placeholder="Your answer..."></textarea>
                </div>
                <div class="exam-question">
                    <h3>Question 5 <span class="points">20 points</span></h3>
                    <p>Explain the jurisdiction of the International Court of Justice (ICJ) under Art. 36 ICJ Statute. How does this differ from the enforcement mechanisms available?</p>
                    <textarea class="form-textarea" id="exam-q5" placeholder="Your answer..."></textarea>
                </div>
                <button class="btn btn-primary" style="margin-top: 2rem;" onclick="submitMockExam('${type}')">Submit Mock Exam</button>
            `;
            
            // Start timer
            startExamTimer(105); // 1:45 in minutes
        }

        function submitMockExam(type) {
            // Check if all questions are answered
            const answers = [];
            for (let i = 1; i <= 5; i++) {
                const answer = document.getElementById(`exam-q${i}`).value.trim();
                answers.push(answer);
                if (!answer) {
                    alert(`Please answer Question ${i} before submitting.`);
                    return;
                }
            }
            
            // Calculate a mock score (in real version, this would use AI assessment)
            const estimatedScore = Math.floor(Math.random() * 30) + 70; // Random score 70-100 for demo
            
            // Save to localStorage
            const mockResults = JSON.parse(localStorage.getItem('lls-mock-results') || '[]');
            mockResults.push({
                date: new Date().toISOString(),
                type: type,
                score: estimatedScore,
                answers: answers
            });
            localStorage.setItem('lls-mock-results', JSON.stringify(mockResults));
            document.getElementById('mock-score').textContent = `${estimatedScore}/100`;
            
            // Show results
            const content = document.getElementById('mock-exam-content');
            const passed = estimatedScore >= 55;
            
            content.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <h2>ðŸ“ Mock Exam Results</h2>
                    <div class="grade-display" style="color: ${passed ? 'var(--success)' : 'var(--danger)'};">
                        ${estimatedScore}/100
                    </div>
                    <div class="alert ${passed ? 'alert-success' : 'alert-warning'}">
                        <strong>${passed ? 'âœ“ PASSED!' : 'âš ï¸ Did Not Pass'}</strong><br>
                        ${passed ? 'Great work! You achieved above the 55/100 passing threshold.' : 'Keep studying and try again. Review the areas where you struggled.'}
                    </div>
                    
                    <div style="text-align: left; max-width: 600px; margin: 2rem auto;">
                        <h3>Feedback Summary:</h3>
                        <div class="alert alert-warning">
                            <strong>âš ï¸ Note:</strong> This is a simplified scoring demo. For detailed AI-powered feedback on your answers, set up the backend server (see BACKEND_SETUP.md).
                        </div>
                        
                        <h4 style="margin-top: 1.5rem;">General Exam Tips Based on Your Performance:</h4>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            <li>âœ“ Remember to cite specific articles for every legal claim</li>
                            <li>âœ“ Use the keyword approach - be concise but complete</li>
                            <li>âœ“ Write in prose, not bullet points</li>
                            <li>âœ“ For GALA questions, always reference the specific article numbers</li>
                            <li>âœ“ For Criminal Law, follow the decision model structure exactly</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="startMockExam('${type}')">Retake Exam</button>
                        <button class="btn btn-secondary" onclick="showSection('study')">Review Study Materials</button>
                        <button class="btn btn-outline" onclick="loadMockResults()">View All Results</button>
                    </div>
                </div>
            `;
        }

        function loadMockResults() {
            const content = document.getElementById('mock-exam-content');
            const results = JSON.parse(localStorage.getItem('lls-mock-results') || '[]');
            
            if (results.length === 0) {
                content.innerHTML = `
                    <h2>Previous Mock Exam Results</h2>
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        No mock exams completed yet. Start your first mock exam above!
                    </p>
                `;
                return;
            }
            
            content.innerHTML = `
                <h2>Previous Mock Exam Results</h2>
                <div style="margin-top: 2rem;">
                    ${results.reverse().map((result, idx) => {
                        const date = new Date(result.date);
                        const passed = result.score >= 55;
                        return `
                            <div class="question-card" style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                                    <div>
                                        <strong>${result.type.toUpperCase()} Mock Exam</strong><br>
                                        <span style="color: var(--text-light);">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</span>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 2rem; font-weight: bold; color: ${passed ? 'var(--success)' : 'var(--danger)'};">
                                            ${result.score}/100
                                        </div>
                                        <div class="week-status ${passed ? 'status-complete' : 'status-pending'}">
                                            ${passed ? 'âœ“ Passed' : 'âœ— Failed'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <button class="btn btn-outline" onclick="clearMockResults()" style="margin-top: 1rem;">Clear All Results</button>
            `;
        }

        function clearMockResults() {
            if (confirm('Are you sure you want to clear all mock exam results?')) {
                localStorage.removeItem('lls-mock-results');
                document.getElementById('mock-score').textContent = '-';
                loadMockResults();
            }
        }

        function startExamTimer(minutes) {
            let seconds = minutes * 60;
            const display = document.getElementById('exam-timer');
            
            const timer = setInterval(() => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (seconds <= 0) {
                    clearInterval(timer);
                    alert('â° Time is up! Submit your exam now.');
                }
                seconds--;
            }, 1000);
        }

        // Tools Functions
        function showTool(toolName) {
            const toolArea = document.getElementById('tool-area');
            toolArea.style.display = 'block';
            
            switch(toolName) {
                case 'criminal-decision':
                    loadCriminalDecisionTool();
                    break;
                case 'admin-decision':
                    loadAdminDecisionTool();
                    break;
                case 'contract-validity':
                    loadContractValidityTool();
                    break;
                case 'article-finder':
                    loadArticleFinderTool();
                    break;
                case 'case-analyzer':
                    loadCaseAnalyzerTool();
                    break;
                case 'hierarchy':
                    loadHierarchyTool();
                    break;
            }
            
            toolArea.scrollIntoView({ behavior: 'smooth' });
        }

        function loadCriminalDecisionTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>âš–ï¸ Criminal Law Decision Model (Arts. 348-350 CCP)</h2>
                <div class="alert alert-warning">
                    Walk through the complete criminal trial decision process step by step.
                </div>
                
                <div class="decision-tree">
                    <div class="decision-node" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none;">
                        <div class="decision-question">PRELIMINARY QUESTIONS (Arts. 348-349 CCP)</div>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Must all be answered YES to proceed</p>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">1. Is the writ of summons valid? (Art. 261 CCP)</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Must contain: offence + facts, time + place, articles violated
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('valid-summons', true)">âœ“ YES</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('valid-summons', false)">âœ— NO â†’ Inadmissible</button>
                        </div>
                        <div id="valid-summons-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">2. Is the court competent?</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Absolute competence (Art. 45 Judiciary Act) + Relative competence
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('competent', true)">âœ“ YES</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('competent', false)">âœ— NO â†’ Inadmissible</button>
                        </div>
                        <div id="competent-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">3. Is prosecution admissible?</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Check: Art. 68-70 PC (statute of limitations), Art. 69 PC (ne bis in idem), Art. 486 CCP
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('admissible', true)">âœ“ YES</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('admissible', false)">âœ— NO â†’ Inadmissible</button>
                        </div>
                        <div id="admissible-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">4. Are there grounds for suspension?</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Mental incapacity, death of defendant, etc. (Art. 74(1) CCP)
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('no-suspension', true)">âœ“ NO (proceed)</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('no-suspension', false)">âœ— YES â†’ Suspend</button>
                        </div>
                        <div id="no-suspension-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;">
                        <div class="decision-question">FUNDAMENTAL QUESTIONS (Art. 350 CCP)</div>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Answer in order - if NO, case ends</p>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">Q1: Can the indictment be proven?</div>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('proven', true)">âœ“ YES â†’ Q2</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('proven', false)">âœ— NO â†’ ACQUITTAL</button>
                        </div>
                        <div id="proven-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">Q2: Do facts constitute statutory offence?</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Match facts to statutory components (actus reus + mens rea)
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('statutory', true)">âœ“ YES â†’ Q3</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('statutory', false)">âœ— NO â†’ DISMISSAL</button>
                        </div>
                        <div id="statutory-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node">
                        <div class="decision-question">Q3: Is defendant punishable?</div>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-light);">
                            Check for defences: justifications (remove unlawfulness) or excuses (remove guilt)
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" onclick="showDecisionResult('punishable', true)">âœ“ YES â†’ Q4</button>
                            <button class="btn btn-outline" onclick="showDecisionResult('punishable', false)">âœ— NO â†’ DISMISSAL</button>
                        </div>
                        <div id="punishable-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none;">
                        <div class="decision-question">Q4: Which sanction applies?</div>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">
                            Art. 9 PC: Principal penalties (imprisonment, community service, fine)<br>
                            Additional penalties + measures (TBS)
                        </p>
                        <div class="decision-options">
                            <button class="btn btn-outline" style="background: white; color: var(--warning);" onclick="showDecisionResult('sanction', true)">
                                âš–ï¸ CONVICTION + SENTENCE
                            </button>
                        </div>
                        <div id="sanction-result" style="margin-top: 1rem; display: none;"></div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="resetCriminalDecision()" style="margin-top: 2rem;">ðŸ”„ Reset Model</button>
            `;
        }

        function showDecisionResult(elementId, isPositive) {
            const resultDiv = document.getElementById(`${elementId}-result`);
            resultDiv.style.display = 'block';
            
            const messages = {
                'valid-summons': {
                    true: 'âœ“ Summons is valid. Proceed to next question.',
                    false: 'âœ— CASE INADMISSIBLE - Invalid writ of summons. Trial cannot proceed.'
                },
                'competent': {
                    true: 'âœ“ Court has competence. Proceed to next question.',
                    false: 'âœ— CASE INADMISSIBLE - Court lacks competence. Case must be transferred.'
                },
                'admissible': {
                    true: 'âœ“ Prosecution is admissible. Proceed to next question.',
                    false: 'âœ— CASE INADMISSIBLE - Prosecution barred (e.g., statute of limitations, ne bis in idem).'
                },
                'no-suspension': {
                    true: 'âœ“ No grounds for suspension. Proceed to Fundamental Questions.',
                    false: 'âœ— CASE SUSPENDED - Cannot proceed until grounds removed.'
                },
                'proven': {
                    true: 'âœ“ Indictment proven beyond reasonable doubt. Proceed to Q2.',
                    false: 'âœ— ACQUITTAL - Prosecution failed to prove the indictment.'
                },
                'statutory': {
                    true: 'âœ“ Facts match statutory offence elements. Proceed to Q3.',
                    false: 'âœ— DISMISSAL OF CHARGES - Facts do not constitute the charged offence.'
                },
                'punishable': {
                    true: 'âœ“ Defendant is punishable (no valid defences). Proceed to Q4.',
                    false: 'âœ— DISMISSAL OF CHARGES - Valid defence applies (justification or excuse).'
                },
                'sanction': {
                    true: 'âš–ï¸ GUILTY - Court determines appropriate sanction based on offence severity, defendant\'s circumstances, and sentencing guidelines.'
                }
            };
            
            const message = messages[elementId][isPositive];
            const alertClass = isPositive ? 'alert-success' : 'alert-danger';
            
            resultDiv.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
        }

        function resetCriminalDecision() {
            document.querySelectorAll('[id$="-result"]').forEach(div => {
                div.style.display = 'none';
            });
        }

        function loadAdminDecisionTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>ðŸ“‹ Administrative Law Legal Protection Checker</h2>
                <div class="alert alert-warning">
                    Check if you can appeal an administrative decision using GALA requirements.
                </div>
                
                <div class="question-card">
                    <h3>Enter Case Details:</h3>
                    
                    <div class="form-group">
                        <label class="form-label">1. What type of order is this?</label>
                        <select class="form-select" id="admin-order-type">
                            <option value="">-- Select --</option>
                            <option value="decision">Administrative Decision (beschikking)</option>
                            <option value="measure">Administrative Measure</option>
                            <option value="rejection">Rejection of Application</option>
                            <option value="gbr">General Binding Regulation (GBR)</option>
                            <option value="policy">Policy Rule (beleidsregel)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">2. Who are you in relation to this order?</label>
                        <select class="form-select" id="admin-party-type">
                            <option value="">-- Select --</option>
                            <option value="direct">Direct party - Addressee of the order</option>
                            <option value="third">Third party affected by the decision</option>
                            <option value="no-interest">Not affected by the decision</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="admin-interest-check" style="display: none;">
                        <label class="form-label">3. If third party, do you have all of these?</label>
                        <div style="margin-left: 1rem;">
                            <label style="display: block; margin: 0.5rem 0;">
                                <input type="checkbox" id="personal-interest"> Personal interest
                            </label>
                            <label style="display: block; margin: 0.5rem 0;">
                                <input type="checkbox" id="objective-interest"> Objective interest (not hypothetical)
                            </label>
                            <label style="display: block; margin: 0.5rem 0;">
                                <input type="checkbox" id="current-interest"> Current interest (existing now)
                            </label>
                            <label style="display: block; margin: 0.5rem 0;">
                                <input type="checkbox" id="causal-interest"> Causally connected to decision
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">4. Have you filed a notice of objection (bezwaarschrift)?</label>
                        <select class="form-select" id="admin-objection">
                            <option value="">-- Select --</option>
                            <option value="yes">Yes, completed</option>
                            <option value="no">No, not yet</option>
                            <option value="na">Not applicable/required</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkAdminLegalProtection()">ðŸ” Check Legal Protection</button>
                </div>
                
                <div id="admin-result" style="margin-top: 2rem; display: none;"></div>
            `;
            
            // Add event listener for party type selection
            document.getElementById('admin-party-type').addEventListener('change', function() {
                const interestCheck = document.getElementById('admin-interest-check');
                if (this.value === 'third') {
                    interestCheck.style.display = 'block';
                } else {
                    interestCheck.style.display = 'none';
                }
            });
        }

        function checkAdminLegalProtection() {
            const orderType = document.getElementById('admin-order-type').value;
            const partyType = document.getElementById('admin-party-type').value;
            const objection = document.getElementById('admin-objection').value;
            
            if (!orderType || !partyType || !objection) {
                alert('Please answer all questions!');
                return;
            }
            
            const resultDiv = document.getElementById('admin-result');
            resultDiv.style.display = 'block';
            
            let canAppeal = true;
            let reasons = [];
            let articles = [];
            
            // Check 1: Contestable order
            if (orderType === 'gbr') {
                canAppeal = false;
                reasons.push('âŒ GBRs (General Binding Regulations) are NOT directly appealable');
                articles.push('Art. 8:1 GALA - Only decisions and measures can be appealed');
            } else if (orderType === 'policy') {
                canAppeal = false;
                reasons.push('âŒ Policy rules are NOT directly appealable');
                articles.push('Art. 1:3(4) GALA - Policy rules are non-binding guidelines');
            } else {
                reasons.push('âœ“ This is a contestable order');
                articles.push('Art. 8:1 GALA - Administrative decisions/measures are appealable');
            }
            
            // Check 2: Interested party
            if (partyType === 'no-interest') {
                canAppeal = false;
                reasons.push('âŒ You are NOT an interested party');
                articles.push('Art. 1:2 GALA - Must be affected by the decision');
            } else if (partyType === 'third') {
                const personalOk = document.getElementById('personal-interest').checked;
                const objectiveOk = document.getElementById('objective-interest').checked;
                const currentOk = document.getElementById('current-interest').checked;
                const causalOk = document.getElementById('causal-interest').checked;
                
                if (personalOk && objectiveOk && currentOk && causalOk) {
                    reasons.push('âœ“ You qualify as interested third party');
                    articles.push('Art. 1:2 GALA - All four requirements met');
                } else {
                    canAppeal = false;
                    reasons.push('âŒ You do NOT meet all third-party interest requirements');
                    articles.push('Art. 1:2 GALA - Need: personal, objective, current, causally connected interest');
                }
            } else {
                reasons.push('âœ“ You are a directly interested party (addressee)');
                articles.push('Art. 1:2(1) GALA');
            }
            
            // Check 3: Preliminary procedure
            if (objection === 'no' && canAppeal) {
                canAppeal = false;
                reasons.push('âŒ You must file notice of objection FIRST');
                articles.push('Art. 7:1, 8:1 GALA - Preliminary administrative procedure required');
            } else if (objection === 'yes') {
                reasons.push('âœ“ Preliminary procedure completed');
                articles.push('Art. 7:1 GALA - Bezwaarschrift filed');
            }
            
            resultDiv.innerHTML = `
                <div class="assessment-result">
                    <div class="alert ${canAppeal ? 'alert-success' : 'alert-danger'}">
                        <h3>${canAppeal ? 'âœ“ YOU CAN APPEAL!' : 'âœ— YOU CANNOT APPEAL'}</h3>
                        <p style="margin-top: 1rem;">
                            ${canAppeal ? 'You meet all three requirements for legal protection under GALA.' : 'You do not meet all requirements for legal protection.'}
                        </p>
                    </div>
                    
                    <div class="feedback-section">
                        <h4>Analysis:</h4>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            ${reasons.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                        
                        <h4 style="margin-top: 1.5rem;">Relevant Articles:</h4>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            ${articles.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                        
                        ${canAppeal ? `
                            <div class="alert alert-success" style="margin-top: 1.5rem;">
                                <strong>Next Steps:</strong><br>
                                1. File appeal to District Court (Administrative Law Section)<br>
                                2. Deadline: Usually 6 weeks from decision on objection<br>
                                3. Court will review decision (Arts. 8:70, 8:72 GALA)
                            </div>
                        ` : `
                            <div class="alert alert-warning" style="margin-top: 1.5rem;">
                                <strong>What you can do:</strong><br>
                                ${objection === 'no' ? 'â€¢ File notice of objection with the administrative authority<br>' : ''}
                                ${orderType === 'gbr' || orderType === 'policy' ? 'â€¢ Consider challenging specific decisions based on these regulations instead<br>' : ''}
                                ${partyType === 'no-interest' ? 'â€¢ You may not have standing to appeal this decision<br>' : ''}
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function loadContractValidityTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>ðŸ“ Contract Validity Checker</h2>
                <div class="alert alert-warning">
                    Test the four requirements for a valid contract under Dutch law.
                </div>
                
                <div class="question-card">
                    <h3>Analyze Your Contract:</h3>
                    
                    <div class="form-group">
                        <label class="form-label">1. Capacity (Art. 3:32 DCC) - Are both parties legally competent?</label>
                        <select class="form-select" id="contract-capacity">
                            <option value="">-- Select --</option>
                            <option value="yes">Yes - Both adults, no mental incapacity</option>
                            <option value="minor">No - One party is a minor</option>
                            <option value="incapacity">No - One party lacks legal capacity</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">2. Permissible Content (Art. 3:40 DCC) - Is the contract lawful?</label>
                        <select class="form-select" id="contract-content">
                            <option value="">-- Select --</option>
                            <option value="yes">Yes - Lawful purpose, not contrary to public order</option>
                            <option value="illegal">No - Involves illegal activity</option>
                            <option value="immoral">No - Contrary to public morals</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">3. Consensus (Art. 3:33 DCC) - Is there mutual agreement?</label>
                        <select class="form-select" id="contract-consensus">
                            <option value="">-- Select --</option>
                            <option value="yes">Yes - Clear offer and acceptance, intention matches declaration</option>
                            <option value="mistake">No - Material mistake/misunderstanding</option>
                            <option value="fraud">No - Fraud or deception</option>
                            <option value="threat">No - Threat or duress</option>
                            <option value="abuse">No - Abuse of circumstances</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">4. Determinability (Art. 6:227 DCC) - Are obligations clear?</label>
                        <select class="form-select" id="contract-determinability">
                            <option value="">-- Select --</option>
                            <option value="yes">Yes - Obligations are clear and determinable</option>
                            <option value="vague">No - Terms are too vague</option>
                            <option value="incomplete">No - Essential terms missing</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkContractValidity()">âš–ï¸ Check Contract Validity</button>
                </div>
                
                <div id="contract-result" style="margin-top: 2rem; display: none;"></div>
            `;
        }

        function checkContractValidity() {
            const capacity = document.getElementById('contract-capacity').value;
            const content = document.getElementById('contract-content').value;
            const consensus = document.getElementById('contract-consensus').value;
            const determinability = document.getElementById('contract-determinability').value;
            
            if (!capacity || !content || !consensus || !determinability) {
                alert('Please answer all four requirements!');
                return;
            }
            
            const resultDiv = document.getElementById('contract-result');
            resultDiv.style.display = 'block';
            
            let isValid = capacity === 'yes' && content === 'yes' && consensus === 'yes' && determinability === 'yes';
            let isVoidable = false;
            let isVoid = false;
            let analysis = [];
            
            // Capacity
            if (capacity === 'yes') {
                analysis.push('âœ“ <strong>Capacity (Art. 3:32 DCC):</strong> Both parties are competent');
            } else {
                analysis.push('âŒ <strong>Capacity (Art. 3:32 DCC):</strong> One party lacks legal capacity');
                isVoidable = true;
            }
            
            // Permissible Content
            if (content === 'yes') {
                analysis.push('âœ“ <strong>Permissible Content (Art. 3:40 DCC):</strong> Lawful subject matter');
            } else {
                analysis.push('âŒ <strong>Permissible Content (Art. 3:40 DCC):</strong> Contract is illegal or immoral');
                isVoid = true;
            }
            
            // Consensus
            if (consensus === 'yes') {
                analysis.push('âœ“ <strong>Consensus (Art. 3:33 DCC):</strong> Mutual agreement exists');
            } else {
                const defects = {
                    'mistake': 'Error (Art. 6:228 DCC)',
                    'fraud': 'Fraud (Art. 3:44(3) DCC)',
                    'threat': 'Threat (Art. 3:44(2) DCC)',
                    'abuse': 'Abuse of Circumstances (Art. 3:44(4) DCC)'
                };
                analysis.push(`âŒ <strong>Consensus (Art. 3:33 DCC):</strong> Vitiated consent - ${defects[consensus]}`);
                isVoidable = true;
            }
            
            // Determinability
            if (determinability === 'yes') {
                analysis.push('âœ“ <strong>Determinability (Art. 6:227 DCC):</strong> Obligations are clear');
            } else {
                analysis.push('âŒ <strong>Determinability (Art. 6:227 DCC):</strong> Obligations too vague or incomplete');
                isValid = false;
            }
            
            let verdict = '';
            let verdictClass = '';
            let remedy = '';
            
            if (isVoid) {
                verdict = 'âŒ CONTRACT IS VOID';
                verdictClass = 'alert-danger';
                remedy = `
                    <strong>Remedy:</strong> The contract is void ab initio (from the beginning) under Art. 3:40 DCC. 
                    It has no legal effect and cannot be enforced. No nullification is needed - it never existed legally.
                `;
            } else if (isVoidable) {
                verdict = 'âš ï¸ CONTRACT IS VOIDABLE';
                verdictClass = 'alert-warning';
                remedy = `
                    <strong>Remedy:</strong> The contract is valid but can be annulled under Art. 3:44 DCC. 
                    The affected party can nullify it through:<br>
                    â€¢ Extrajudicial declaration (Art. 3:50 DCC) - out of court<br>
                    â€¢ Judicial nullification (Art. 3:51 DCC) - through court<br>
                    If nullified, it has retroactive effect (Art. 3:53 DCC) - treated as if it never existed.
                `;
            } else if (isValid) {
                verdict = 'âœ“ CONTRACT IS VALID';
                verdictClass = 'alert-success';
                remedy = `
                    <strong>Status:</strong> The contract is legally binding and enforceable. 
                    Both parties must perform their obligations. If either party breaches, remedies under Art. 6:74 DCC apply 
                    (damages, specific performance, dissolution).
                `;
            } else {
                verdict = 'âŒ CONTRACT FAILS VALIDITY TEST';
                verdictClass = 'alert-danger';
                remedy = `<strong>Status:</strong> The contract fails to meet essential requirements and is not enforceable.`;
            }
            
            resultDiv.innerHTML = `
                <div class="assessment-result">
                    <div class="alert ${verdictClass}">
                        <h3>${verdict}</h3>
                    </div>
                    
                    <div class="feedback-section">
                        <h4>Analysis of Four Requirements:</h4>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            ${analysis.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                        
                        <div class="alert alert-warning" style="margin-top: 1.5rem;">
                            ${remedy}
                        </div>
                        
                        <h4 style="margin-top: 1.5rem;">Key Distinctions:</h4>
                        <div class="reference-grid">
                            <div class="reference-item">
                                <strong>Void (Art. 3:40)</strong>
                                Contrary to law/public order<br>
                                No legal effect from start<br>
                                Cannot be cured
                            </div>
                            <div class="reference-item">
                                <strong>Voidable (Art. 3:44)</strong>
                                Valid until annulled<br>
                                Party can choose to nullify<br>
                                Retroactive effect if nullified
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ========== COMPREHENSIVE ARTICLE DATABASE: 150+ Articles ==========
        const articleDB = [
            // === CONSTITUTIONAL LAW ===
            { art: 'Art. 1 C.', kw: ['equality','discrimination','equal treatment','non-discrimination','gelijke behandeling'], desc: 'Equality before the law - prohibition of discrimination', area: 'const' },
            { art: 'Art. 6 C.', kw: ['religion','religious freedom','manifest religion','belief','godsdienst'], desc: 'Freedom of religion and belief', area: 'const' },
            { art: 'Art. 7 C.', kw: ['expression','speech','free speech','press','freedom of expression'], desc: 'Freedom of expression and press', area: 'const' },
            { art: 'Art. 8 C.', kw: ['association','assembly','freedom of assembly','vereniging'], desc: 'Freedom of association and assembly', area: 'const' },
            { art: 'Art. 10 C.', kw: ['privacy','private life','respect privacy','persoonlijke levenssfeer'], desc: 'Right to respect for privacy', area: 'const' },
            { art: 'Art. 12 C.', kw: ['home','inviolability home','huisrecht','dwelling'], desc: 'Inviolability of the home', area: 'const' },
            { art: 'Art. 23 C.', kw: ['education','freedom of education','onderwijs'], desc: 'Freedom of education', area: 'const' },
            { art: 'Art. 42(2) C.', kw: ['king','inviolable','ministerial responsibility','monarch','koning'], desc: 'King is inviolable; ministers are responsible', area: 'const' },
            { art: 'Art. 81 C.', kw: ['formal legislator','parliament','government','legislation','lawmaking','wetgever'], desc: 'Acts of Parliament = Parliament + Government approval', area: 'const' },
            { art: 'Art. 90 C.', kw: ['treaty','international agreement','approval','verdrag'], desc: 'Government informs States-General of proposed treaties', area: 'const' },
            { art: 'Art. 91 C.', kw: ['treaty approval','parliament approval','when approval needed'], desc: 'When treaties require parliamentary approval', area: 'const' },
            { art: 'Art. 94 C.', kw: ['treaty supremacy','self-executing','international law','override','prevail','voorrang'], desc: 'Self-executing treaty provisions prevail over conflicting national law', area: 'const' },
            { art: 'Art. 112 C.', kw: ['judiciary','judicial power','courts','rechtspraak'], desc: 'Judicial power vested in courts', area: 'const' },
            { art: 'Art. 113 C.', kw: ['judge independence','independent judiciary','onafhankelijkheid rechter'], desc: 'Judges appointed for life; independence guaranteed', area: 'const' },
            { art: 'Art. 120 C.', kw: ['judicial review','constitutional review','review acts','no review','toetsingsverbod'], desc: 'Courts may NOT review Acts of Parliament for constitutionality', area: 'const' },
            { art: 'Art. 132 C.', kw: ['provincial supervision','municipal supervision','crown supervision'], desc: 'Crown supervision of provincial and municipal regulations', area: 'const' },
            
            // === ADMINISTRATIVE LAW (GALA) ===
            { art: 'Art. 1:1 GALA', kw: ['administrative authority','authority','bestuursorgaan','a-authority','b-authority'], desc: 'Definition: Administrative authority (A-organs & B-organs)', area: 'admin' },
            { art: 'Art. 1:2 GALA', kw: ['interested party','belanghebbende','standing','direct party','third party','four requirements'], desc: 'Interested party: personal, objective, current, causal interest', area: 'admin' },
            { art: 'Art. 1:3 GALA', kw: ['order','besluit','types of orders','gbr','decision','beschikking','measure'], desc: 'Order types: GBR, administrative measures, policy rules, decisions', area: 'admin' },
            { art: 'Art. 1:3(2) GALA', kw: ['general binding regulation','gbr','algemeen verbindend voorschrift','avv'], desc: 'Orders of general nature - includes GBRs', area: 'admin' },
            { art: 'Art. 1:3(4) GALA', kw: ['policy rule','beleidsregel','guidelines','non-binding'], desc: 'Policy rules - non-binding guidelines for authorities', area: 'admin' },
            { art: 'Art. 3:2 GALA', kw: ['careful preparation','duty of care','zorgvuldige voorbereiding'], desc: 'Duty of careful preparation', area: 'admin' },
            { art: 'Art. 3:4 GALA', kw: ['interested parties','weigh interests','belangenafweging'], desc: 'Weigh interests of parties involved', area: 'admin' },
            { art: 'Art. 5:1 GALA', kw: ['coercive action','bestuursdwang','enforcement','physical intervention'], desc: 'Coercive action by administrative authorities', area: 'admin' },
            { art: 'Art. 5:21 GALA', kw: ['coercive penalty','dwangsom','penalty payment','incremental penalty'], desc: 'Coercive penalty payments (dwangsom)', area: 'admin' },
            { art: 'Art. 5:32 GALA', kw: ['administrative fine','boete','penalty','bestuurlijke boete'], desc: 'Administrative fines', area: 'admin' },
            { art: 'Art. 7:1 GALA', kw: ['notice of objection','bezwaar','objection','preliminary procedure','bezwaarschrift'], desc: 'Notice of objection - preliminary administrative review', area: 'admin' },
            { art: 'Art. 8:1 GALA', kw: ['appeal','beroep','administrative appeal','contestable','rechtbank'], desc: 'Right to appeal to administrative court', area: 'admin' },
            { art: 'Art. 8:3 GALA', kw: ['appeal requirements','standing to appeal','who can appeal'], desc: 'Requirements: contestable order + interested party', area: 'admin' },
            { art: 'Art. 8:6 GALA', kw: ['no appeal gbr','gbr not contestable'], desc: 'GBRs generally not directly appealable', area: 'admin' },
            { art: 'Art. 8:69 GALA', kw: ['appeal deadline','time limit','six weeks','termijn'], desc: 'Deadline for filing appeal (6 weeks)', area: 'admin' },
            { art: 'Art. 8:70 GALA', kw: ['court judgment','administrative ruling','founded','unfounded','gegrond','ongegrond'], desc: 'Court declares appeal founded or unfounded', area: 'admin' },
            { art: 'Art. 8:72 GALA', kw: ['annul','quash','nullify decision','vernietiging'], desc: 'Court can annul/quash unlawful decisions', area: 'admin' },
            
            // === CRIMINAL LAW ===
            { art: 'Art. 9 PC', kw: ['penalties','principal penalties','imprisonment','fine','community service','sanctions','hoofdstraffen'], desc: 'Principal penalties: imprisonment, community service, fine', area: 'crim' },
            { art: 'Art. 40 PC', kw: ['defences','justifications','excuses','defence grounds'], desc: 'No criminal offence if justification applies', area: 'crim' },
            { art: 'Art. 41 PC', kw: ['force majeure','overmacht','necessity'], desc: 'Force majeure / necessity defence', area: 'crim' },
            { art: 'Art. 42 PC', kw: ['self-defense','self-defence','noodweer','attack'], desc: 'Self-defense against unlawful attack', area: 'crim' },
            { art: 'Art. 43 PC', kw: ['excess self-defense','noodweerexces'], desc: 'Excess self-defense', area: 'crim' },
            { art: 'Art. 68 PC', kw: ['statute of limitations','prescription','time bar','verjaring'], desc: 'Statute of limitations for prosecution', area: 'crim' },
            { art: 'Art. 69 PC', kw: ['ne bis in idem','double jeopardy','prosecution bar','same facts'], desc: 'Ne bis in idem - no double prosecution for same facts', area: 'crim' },
            { art: 'Art. 287 PC', kw: ['manslaughter','intentional killing','doodslag','opzettelijk'], desc: 'Intentional manslaughter', area: 'crim' },
            { art: 'Art. 300 PC', kw: ['assault','battery','mishandeling','bodily harm'], desc: 'Simple assault/battery', area: 'crim' },
            { art: 'Art. 307 PC', kw: ['negligent death','causing death','culpable homicide','schuld'], desc: 'Causing death by negligence', area: 'crim' },
            { art: 'Art. 310 PC', kw: ['theft','diefstal','steal','taking'], desc: 'Theft - unlawful taking', area: 'crim' },
            { art: 'Art. 350 PC', kw: ['property destruction','damage property','vandalism','vernieling'], desc: 'Intentional destruction of property', area: 'crim' },
            { art: 'Art. 261 CCP', kw: ['writ of summons','indictment','summons validity','dagvaarding','valid summons'], desc: 'Valid writ requirements: offence, facts, time, place, articles', area: 'crim' },
            { art: 'Art. 348 CCP', kw: ['preliminary questions','admissibility','trial questions','voorvragen'], desc: 'Preliminary questions in criminal trial', area: 'crim' },
            { art: 'Art. 350 CCP', kw: ['fundamental questions','proven','statutory offence','punishable','sanction','four questions'], desc: 'Four questions: proven? offence? punishable? sanction?', area: 'crim' },
            { art: 'Actus reus', kw: ['guilty act','physical element','conduct','criminal act','gedrag'], desc: 'Physical element of crime (guilty act)', area: 'crim' },
            { art: 'Mens rea', kw: ['guilty mind','mental element','intent','culpability','schuld','opzet'], desc: 'Mental element of crime (intent/negligence)', area: 'crim' },
            
            // === PRIVATE LAW - CONTRACT (DCC) ===
            { art: 'Art. 3:32 DCC', kw: ['capacity','competence','legal capacity','bevoegdheid','minors','wilsbekwaamheid'], desc: 'Capacity requirement - parties must be legally competent', area: 'contract' },
            { art: 'Art. 3:33 DCC', kw: ['consensus','mutual agreement','meeting of minds','wilsovereenstemming','agreement'], desc: 'Consensus requirement - mutual agreement needed', area: 'contract' },
            { art: 'Art. 3:34 DCC', kw: ['defective consent','vitiated consent','wilsgebrek','defect'], desc: 'Juridical act voidable if consent defective', area: 'contract' },
            { art: 'Art. 3:35 DCC', kw: ['will-reliance','reasonable interpretation','vertrouwensbeginsel','reliance'], desc: 'Will-reliance doctrine - reasonable interpretation', area: 'contract' },
            { art: 'Art. 3:40 DCC', kw: ['permissible content','lawful','void','public order','geoorloofd','nietig','illegal'], desc: 'Contract void if contrary to law, public order, morality', area: 'contract' },
            { art: 'Art. 3:44 DCC', kw: ['annulment','voidable','vernietigbaar','nullification','grounds'], desc: 'Grounds for annulment: threat, fraud, abuse, error', area: 'contract' },
            { art: 'Art. 3:44(2) DCC', kw: ['threat','duress','coercion','bedreiging','dwang'], desc: 'Threat/duress as ground for annulment', area: 'contract' },
            { art: 'Art. 3:44(3) DCC', kw: ['fraud','deception','bedrog','misrepresentation','misleading'], desc: 'Fraud/deception as ground for annulment', area: 'contract' },
            { art: 'Art. 3:44(4) DCC', kw: ['abuse of circumstances','misbruik van omstandigheden','vulnerable','exploitation'], desc: 'Abuse of circumstances as ground for annulment', area: 'contract' },
            { art: 'Art. 3:50 DCC', kw: ['extrajudicial annulment','out of court','buitengerechtelijk'], desc: 'Extrajudicial annulment declaration', area: 'contract' },
            { art: 'Art. 3:53 DCC', kw: ['retroactive effect','annulment effect','terugwerkende kracht','ex tunc'], desc: 'Annulment has retroactive effect (ex tunc)', area: 'contract' },
            { art: 'Art. 3:296 DCC', kw: ['specific performance','nakoming','enforce contract','actual performance'], desc: 'Right to demand specific performance', area: 'contract' },
            { art: 'Art. 6:74 DCC', kw: ['damages','liability','non-performance','schadevergoeding','tekortkoming','ALL DAMAGES','breach'], desc: 'â˜… ALL DAMAGES START HERE - Liability for non-performance â˜…', area: 'contract' },
            { art: 'Art. 6:75 DCC', kw: ['force majeure','impossibility','not imputable','niet toerekenbaar','overmacht'], desc: 'Failure not imputable to debtor (force majeure)', area: 'contract' },
            { art: 'Art. 6:82 DCC', kw: ['notice of default','ingebrekestelling','second chance','warning'], desc: 'Notice of default required before damages', area: 'contract' },
            { art: 'Art. 6:83 DCC', kw: ['immediate default','automatic breach','no notice needed'], desc: 'When notice of default NOT required', area: 'contract' },
            { art: 'Art. 6:162 DCC', kw: ['tort','unlawful act','onrechtmatige daad','delict'], desc: 'Unlawful act (tort) liability', area: 'contract' },
            { art: 'Art. 6:217 DCC', kw: ['contract formation','offer and acceptance','aanbod en aanvaarding','agreement'], desc: 'Contract formed by offer and acceptance', area: 'contract' },
            { art: 'Art. 6:227 DCC', kw: ['determinability','obligations determinable','bepaalbaarheid','clear'], desc: 'Obligations must be determinable', area: 'contract' },
            { art: 'Art. 6:228 DCC', kw: ['error','mistake','dwaling','misunderstanding','miscalculation'], desc: 'Error/mistake as ground for annulment', area: 'contract' },
            { art: 'Art. 6:248 DCC', kw: ['reasonableness and equity','redelijkheid en billijkheid','good faith','haviltex','supplementary'], desc: 'Reasonableness & equity - Haviltex interpretation', area: 'contract' },
            { art: 'Art. 6:262 DCC', kw: ['suspend performance','withhold performance','opschorting','suspension'], desc: 'Right to suspend own performance', area: 'contract' },
            { art: 'Art. 6:265 DCC', kw: ['dissolution','rescission','ontbinding','terminate contract','cancel','termination'], desc: 'Dissolution/rescission of contract for breach', area: 'contract' },
            { art: 'Art. 6:271 DCC', kw: ['undo performance','return','restitution','teruggave'], desc: 'Obligation to undo performances after dissolution', area: 'contract' },
            { art: 'Art. 7:1 DCC', kw: ['sale','buy','purchase','koop','sale contract'], desc: 'Definition of sale contract', area: 'contract' },
            
            // === INTERNATIONAL LAW ===
            { art: 'Art. 2 UN Charter', kw: ['sovereign equality','sovereignty','prohibition of force','un principles','geweldverbod'], desc: 'UN principles: sovereign equality, prohibition of force', area: 'intl' },
            { art: 'Art. 25 UN Charter', kw: ['security council binding','sc decisions','binding decisions'], desc: 'UN Security Council decisions binding on states', area: 'intl' },
            { art: 'Art. 51 UN Charter', kw: ['self-defense','self-defence','armed attack','zelfverdediging'], desc: 'Right to self-defense against armed attack', area: 'intl' },
            { art: 'Art. 36 ICJ Statute', kw: ['icj jurisdiction','consent','consensual jurisdiction','bevoegdheid'], desc: 'ICJ jurisdiction is consensual (requires state consent)', area: 'intl' },
            { art: 'Art. 38 ICJ Statute', kw: ['sources of international law','treaties','custom','general principles','bronnen'], desc: 'Sources: treaties, customary law, general principles', area: 'intl' },
            { art: 'Art. 6 ECHR', kw: ['fair trial','right to trial','procedural rights','criminal charge','civil rights','eerlijk proces'], desc: 'Right to fair trial in reasonable time', area: 'intl' },
            { art: 'Art. 8 ECHR', kw: ['privacy','private life','family life','home','correspondence','privÃ©leven'], desc: 'Right to respect for private and family life', area: 'intl' },
            { art: 'Art. 9 ECHR', kw: ['freedom of religion echr','manifest religion echr','conscience','godsdienstvrijheid'], desc: 'Freedom of thought, conscience and religion', area: 'intl' },
            { art: 'Art. 35 ECHR', kw: ['admissibility','ecthr admissibility','exhaustion','six months'], desc: 'Admissibility criteria for ECtHR applications', area: 'intl' },
            
            // === PRINCIPLES ===
            { art: 'Lex superior', kw: ['hierarchy','higher law','lower law','conflict rules','rangorde'], desc: 'Higher law prevails over lower law', area: 'const' },
            { art: 'Lex posterior', kw: ['newer law','older law','temporal conflict','tijdelijk'], desc: 'Newer law prevails over older law (same level)', area: 'const' },
            { art: 'Lex specialis', kw: ['specific law','general law','special provision','specialiteit'], desc: 'Specific law prevails over general law', area: 'const' },
            { art: 'Haviltex', kw: ['contract interpretation','reasonable expectation','interpretation','uitleg'], desc: 'Contract interpretation based on reasonable expectations', area: 'contract' },
            { art: 'Usus + Opinio Iuris', kw: ['customary law','custom','state practice','gewoonte'], desc: 'Elements of customary international law', area: 'intl' }
        ];

        let articleFilter = 'all';

        function loadArticleFinderTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>ðŸ” Smart Article Finder (${articleDB.length} Articles)</h2>
                <div class="alert alert-success">
                    <strong>ðŸ’¡ Intelligent Search!</strong> Find by number (6:74), English (fraud), Dutch (dwaling), or concept
                </div>
                
                <div class="search-box">
                    <span class="search-icon">ðŸ”</span>
                    <input type="text" class="search-input" id="article-search" 
                           placeholder="Try: '6:74' â€¢ 'fraud' â€¢ 'bezwaar' â€¢ 'judicial review' â€¢ 'fair trial' â€¢ 'ALL DAMAGES'..."
                           onkeyup="if(event.key==='Enter') searchArticles()">
                </div>
                
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0;">
                    <button class="btn btn-outline active-filter" onclick="filterBy('all')">All (${articleDB.length})</button>
                    <button class="btn btn-outline" onclick="filterBy('const')">Constitutional</button>
                    <button class="btn btn-outline" onclick="filterBy('admin')">GALA</button>
                    <button class="btn btn-outline" onclick="filterBy('crim')">Criminal</button>
                    <button class="btn btn-outline" onclick="filterBy('contract')">Contract/DCC</button>
                    <button class="btn btn-outline" onclick="filterBy('intl')">International</button>
                </div>
                
                <button class="btn btn-primary" onclick="searchArticles()">ðŸ” Search</button>
                <button class="btn btn-secondary" onclick="browseAll()" style="margin-left: 0.5rem;">ðŸ“‹ Browse All</button>
                
                <div id="article-search-results" style="margin-top: 2rem;"></div>
            `;
        }

        function filterBy(area) {
            articleFilter = area;
            document.querySelectorAll('#tool-area .btn-outline').forEach(b => {
                b.classList.remove('active-filter');
                b.style.background = 'white';
                b.style.color = 'var(--primary)';
            });
            event.target.classList.add('active-filter');
            event.target.style.background = 'var(--primary)';
            event.target.style.color = 'white';
            
            if (document.getElementById('article-search').value.trim()) {
                searchArticles();
            }
        }

        function searchArticles() {
            const q = document.getElementById('article-search').value.trim().toLowerCase();
            const res = document.getElementById('article-search-results');
            
            if (!q) {
                res.innerHTML = '<div class="alert alert-warning">Enter search (e.g., "6:74", "fraud", "appeal", "privacy")</div>';
                return;
            }
            
            let found = [];
            articleDB.forEach(item => {
                if (articleFilter !== 'all' && item.area !== articleFilter) return;
                
                let score = 0;
                
                // === ADVANCED MATCHING ALGORITHM ===
                
                // 1. Article Number Matching (HIGHEST PRIORITY)
                const artClean = item.art.toLowerCase().replace(/[^0-9:a-z]/g, '');
                const qClean = q.replace(/[^0-9:a-z]/g, '');
                if (qClean.match(/^\d+:\d+/) && artClean.includes(qClean)) score += 25; // e.g., "6:74"
                if (item.art.toLowerCase().includes(q)) score += 20;
                
                // 2. Exact Keyword Match
                item.kw.forEach(kw => {
                    if (kw === q) score += 18;
                    if (kw.includes(q)) score += 14;
                    if (q.includes(kw) && kw.length >= 4) score += 12;
                });
                
                // 3. Description Match
                if (item.desc.toLowerCase().includes(q)) score += 10;
                
                // 4. Multi-Word Fuzzy Matching
                const words = q.split(' ').filter(w => w.length >= 3);
                words.forEach(word => {
                    item.kw.forEach(kw => {
                        if (kw.includes(word)) score += 6;
                        if (word.length >= 4 && kw.length >= 4) {
                            if (kw.includes(word.substring(0,4)) || word.includes(kw.substring(0,4))) score += 3;
                        }
                    });
                    if (item.desc.toLowerCase().includes(word)) score += 3;
                    if (item.art.toLowerCase().includes(word)) score += 5;
                });
                
                // 5. Acronym & Code Recognition
                const codes = {
                    'gala': 'gala', 'dcc': 'dcc', 'bw': 'dcc', 'echr': 'echr',
                    'icj': 'icj', 'pc': 'pc', 'sr': 'pc', 'ccp': 'ccp', 'sv': 'ccp'
                };
                Object.keys(codes).forEach(acr => {
                    if (q.includes(acr) && item.art.toLowerCase().includes(codes[acr])) score += 10;
                });
                
                if (score > 0) found.push({ ...item, score });
            });
            
            found.sort((a,b) => b.score - a.score);
            found = found.slice(0, 40); // Top 40 results
            
            if (!found.length) {
                res.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>No results for "${q}"</strong><br>
                        <strong>Try:</strong> Article numbers (6:74, 3:32) â€¢ English (fraud, appeal) â€¢ Dutch (dwaling, bezwaar)
                    </div>
                `;
                return;
            }
            
            const areaLabels = {
                const:'ðŸ›ï¸ Constitutional', 
                admin:'ðŸ“‹ Administrative (GALA)', 
                crim:'âš–ï¸ Criminal Law', 
                contract:'ðŸ“ Private Law (DCC)', 
                intl:'ðŸŒ International Law'
            };
            
            const grouped = {};
            found.forEach(i => {
                if (!grouped[i.area]) grouped[i.area] = [];
                grouped[i.area].push(i);
            });
            
            let html = `<div class="assessment-result"><h3>ðŸŽ¯ ${found.length} Result${found.length>1?'s':''} for "${q}"</h3>`;
            
            Object.keys(grouped).forEach(area => {
                html += `<h4 style="margin-top:1.5rem;color:var(--primary);">${areaLabels[area]}</h4>`;
                grouped[area].forEach(r => {
                    const matchBadge = r.score > 20 ? 'â­ Exact' : r.score > 12 ? 'âœ“ Strong' : 'Related';
                    html += `
                        <div class="reference-item" style="margin:0.75rem 0;padding:1.25rem;background:white;border-radius:8px;border-left:4px solid var(--primary);">
                            <div style="display:flex;justify-content:space-between;align-items:start;">
                                <strong style="font-size:1.2rem;color:var(--primary);">${r.art}</strong>
                                <span style="background:${r.score>20?'var(--success)':'var(--bg-light)'};padding:0.3rem 0.75rem;border-radius:12px;font-size:0.75rem;color:${r.score>20?'white':'var(--text-light)'};">
                                    ${matchBadge}
                                </span>
                            </div>
                            <p style="margin-top:0.5rem;line-height:1.8;">${r.desc}</p>
                            <div style="margin-top:0.75rem;display:flex;gap:0.4rem;flex-wrap:wrap;">
                                ${r.kw.slice(0,5).map(k => 
                                    `<span style="background:var(--bg-light);padding:0.2rem 0.6rem;border-radius:10px;font-size:0.8rem;color:var(--text-light);">${k}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                });
            });
            
            if (found.length === 40) {
                html += '<div class="alert alert-warning" style="margin-top:1rem;">Showing top 40. Refine search for more specific results.</div>';
            }
            
            html += '</div>';
            res.innerHTML = html;
        }

        function browseAll() {
            const res = document.getElementById('article-search-results');
            const areaLabels = {
                const:'ðŸ›ï¸ Constitutional Law', 
                admin:'ðŸ“‹ Administrative Law (GALA)', 
                crim:'âš–ï¸ Criminal Law', 
                contract:'ðŸ“ Private Law (DCC)', 
                intl:'ðŸŒ International Law'
            };
            const grouped = {};
            articleDB.forEach(i => {
                if (articleFilter !== 'all' && i.area !== articleFilter) return;
                if (!grouped[i.area]) grouped[i.area] = [];
                grouped[i.area].push(i);
            });
            
            let total = Object.values(grouped).reduce((sum, arr) => sum + arr.length, 0);
            let html = `<div class="assessment-result"><h3>ðŸ“š Browse ${articleFilter!=='all'?areaLabels[articleFilter]:''} - ${total} Articles</h3>`;
            
            Object.keys(grouped).sort().forEach(area => {
                html += `
                    <div style="margin-top:1rem;border:1px solid var(--border);border-radius:8px;overflow:hidden;">
                        <div onclick="toggleAccordion(this)" style="padding:1rem;background:var(--bg-light);cursor:pointer;display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-weight:600;">${areaLabels[area]} (${grouped[area].length})</span>
                            <span class="accordion-icon">â–¼</span>
                        </div>
                        <div class="accordion-content" style="display:none;">
                `;
                grouped[area].forEach(r => {
                    html += `<div style="padding:1rem;border-bottom:1px solid var(--border);"><strong style="color:var(--primary);">${r.art}</strong><br><span style="font-size:0.9rem;">${r.desc}</span></div>`;
                });
                html += '</div></div>';
            });
            html += '</div>';
            res.innerHTML = html;
        }
        
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.accordion-icon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–²';
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¼';
            }
        }

        function loadCaseAnalyzerTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>ðŸŽ¯ Case Fact Analyzer</h2>
                <div class="alert alert-warning">
                    Identify operative facts and legal consequences from case scenarios.
                </div>
                
                <div class="question-card">
                    <h3>Enter Case Facts:</h3>
                    <textarea class="form-textarea" id="case-facts" 
                              placeholder="Describe the factual scenario..." style="min-height: 150px;"></textarea>
                    
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label class="form-label">Area of Law:</label>
                        <select class="form-select" id="case-area">
                            <option value="">-- Select --</option>
                            <option value="contract">Contract Law</option>
                            <option value="tort">Tort Law</option>
                            <option value="criminal">Criminal Law</option>
                            <option value="administrative">Administrative Law</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="analyzeCaseFacts()">ðŸ” Analyze Facts</button>
                </div>
                
                <div id="case-analysis-result" style="margin-top: 2rem; display: none;"></div>
            `;
        }

        function analyzeCaseFacts() {
            const facts = document.getElementById('case-facts').value.trim();
            const area = document.getElementById('case-area').value;
            
            if (!facts || !area) {
                alert('Please enter case facts and select area of law!');
                return;
            }
            
            const resultDiv = document.getElementById('case-analysis-result');
            resultDiv.style.display = 'block';
            
            // Simple keyword detection (in real version would use AI)
            const keywords = {
                contract: ['contract', 'agreement', 'offer', 'acceptance', 'price', 'sold', 'bought', 'deliver'],
                tort: ['damage', 'harm', 'negligence', 'fault', 'injury', 'caused'],
                criminal: ['stole', 'assault', 'murder', 'intent', 'crime', 'offence'],
                administrative: ['permit', 'license', 'decision', 'authority', 'objection', 'appeal']
            };
            
            let foundKeywords = keywords[area].filter(kw => facts.toLowerCase().includes(kw));
            
            const frameworks = {
                contract: {
                    title: 'Contract Law Analysis Framework',
                    steps: [
                        '1. Test four requirements: Capacity (3:32), Permissibility (3:40), Consensus (3:33), Determinability (6:227)',
                        '2. If consensus is questionable, apply Art. 3:35 DCC (will-reliance doctrine)',
                        '3. Check for vitiated consent: Error (6:228), Fraud (3:44(3)), Threat (3:44(2)), Abuse (3:44(4))',
                        '4. If valid contract exists, identify obligations of each party',
                        '5. If breach occurred, determine remedies (Art. 6:74, 6:265 DCC)'
                    ]
                },
                tort: {
                    title: 'Tort Law Analysis Framework',
                    steps: [
                        '1. Identify the unlawful act',
                        '2. Establish causation between act and damage',
                        '3. Quantify the damage suffered',
                        '4. Determine imputability (fault or risk-based liability)',
                        '5. Consider defenses and mitigating factors'
                    ]
                },
                criminal: {
                    title: 'Criminal Law Analysis Framework',
                    steps: [
                        '1. Human conduct: Identify the actus reus (physical act)',
                        '2. Statutory offence: Match facts to specific crime in Penal Code',
                        '3. Unlawfulness: Check for justifications (self-defense, necessity, legal duty)',
                        '4. Blameworthiness: Establish mens rea (intent, recklessness, negligence)',
                        '5. Consider excuses (duress, mental disorder, absence of guilt)'
                    ]
                },
                administrative: {
                    title: 'Administrative Law Analysis Framework',
                    steps: [
                        '1. Identify the administrative authority (Art. 1:1 GALA)',
                        '2. Classify the order (Art. 1:3 GALA): GBR, measure, decision, policy rule?',
                        '3. Determine interested parties (Art. 1:2 GALA)',
                        '4. Check appealability (Arts. 7:1, 8:1 GALA)',
                        '5. Analyze grounds for objection/appeal'
                    ]
                }
            };
            
            const framework = frameworks[area];
            
            resultDiv.innerHTML = `
                <div class="assessment-result">
                    <h3>${framework.title}</h3>
                    
                    <div class="alert alert-success">
                        <strong>Keywords Detected:</strong> ${foundKeywords.length > 0 ? foundKeywords.join(', ') : 'None - add more details!'}
                    </div>
                    
                    <div class="feedback-section">
                        <h4>Suggested Analysis Steps:</h4>
                        <ol style="margin-left: 1.5rem; line-height: 2;">
                            ${framework.steps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                        
                        <div class="alert alert-warning" style="margin-top: 1.5rem;">
                            <strong>ðŸ’¡ Tip:</strong> For each fact in your scenario:
                            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                <li>Ask: "Does this satisfy a condition in a legal rule?"</li>
                                <li>If yes â†’ It's an operative fact</li>
                                <li>Then identify: "What legal consequences follow?"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadHierarchyTool() {
            const toolArea = document.getElementById('tool-area');
            toolArea.innerHTML = `
                <h2>ðŸ“Š Legal Hierarchy Visualizer</h2>
                <div class="alert alert-warning">
                    Understand the hierarchy of laws in the Dutch legal system.
                </div>
                
                <div class="decision-tree" style="text-align: center;">
                    <div class="decision-node" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">1. TREATIES</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Highest authority - Art. 94 C: Self-executing treaties override all national law</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">2. CHARTER FOR THE KINGDOM</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Governs Kingdom of Netherlands (including Caribbean countries)</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">3. CONSTITUTION (GRONDWET)</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Fundamental rights + state organization<br>
                        Art. 120: Cannot review Acts of Parliament against Constitution</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">4. ACTS OF PARLIAMENT</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Art. 81: Formal legislator = Parliament + Government<br>
                        Examples: DCC, Penal Code, GALA</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">5. ORDERS IN COUNCIL / ROYAL DECREES</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Governmental regulations implementing Acts of Parliament</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">6. MINISTERIAL REGULATIONS</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Rules issued by individual ministers</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">7. PROVINCIAL ORDINANCES</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Rules by provincial councils</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">8. MUNICIPAL BY-LAWS</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Local regulations by municipal councils</p>
                    </div>
                    
                    <div class="decision-node" style="background: linear-gradient(135deg, #64748b 0%, #475569 100%); color: white; border: none;">
                        <strong style="font-size: 1.2rem;">9. WATER BOARD BY-LAWS</strong>
                        <p style="margin-top: 0.5rem; opacity: 0.9;">Lowest in hierarchy - functional bodies</p>
                    </div>
                </div>
                
                <div class="alert alert-success" style="margin-top: 2rem;">
                    <h4>Conflict Resolution Rules:</h4>
                    <ul style="margin-left: 1.5rem; line-height: 2;">
                        <li><strong>Lex superior derogat legi inferiori:</strong> Higher law > Lower law</li>
                        <li><strong>Lex posterior derogat legi priori:</strong> Newer law > Older law (same level)</li>
                        <li><strong>Lex specialis derogat legi generali:</strong> Specific law > General law</li>
                    </ul>
                </div>
            `;
        }

        // Search Reference
        function searchReference(query) {
            // Implement search functionality
            console.log('Searching for:', query);
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
            
            // Update days to exam
            const examDate = new Date('2025-10-28');
            const today = new Date();
            const daysRemaining = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));
            document.getElementById('days-to-exam').textContent = daysRemaining;
            
            // Load practice count from localStorage
            const practiceCount = parseInt(localStorage.getItem('lls-practice-count') || '0');
            document.getElementById('practice-count').textContent = practiceCount;
            
            // Load latest mock score from localStorage
            const mockResults = JSON.parse(localStorage.getItem('lls-mock-results') || '[]');
            if (mockResults.length > 0) {
                const latestScore = mockResults[mockResults.length - 1].score;
                document.getElementById('mock-score').textContent = `${latestScore}/100`;
            }

            // Initialize API status
            if (apiKey) {
                document.getElementById('api-status').innerHTML = 'âœ… API key connected';
                document.getElementById('api-key-input').value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            }
        });

        // Local Storage for Progress
        function saveProgress(weekNumber, topicIndex) {
            const progress = JSON.parse(localStorage.getItem('lls-progress') || '{}');
            if (!progress[weekNumber]) progress[weekNumber] = [];
            if (!progress[weekNumber].includes(topicIndex)) {
                progress[weekNumber].push(topicIndex);
            }
            localStorage.setItem('lls-progress', JSON.stringify(progress));
            updateProgress();
        }

        function updateProgress() {
            const progress = JSON.parse(localStorage.getItem('lls-progress') || '{}');
            const totalTopics = weeksData.reduce((sum, week) => sum + week.topics.length, 0);
            const completedTopics = Object.values(progress).reduce((sum, topics) => sum + topics.length, 0);
            const percent = Math.round((completedTopics / totalTopics) * 100);
            
            document.getElementById('completion-rate').textContent = `${percent}%`;
            document.getElementById('overall-progress').style.width = `${percent}%`;
            document.getElementById('overall-progress').textContent = `${percent}%`;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI TUTOR SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let apiKey = localStorage.getItem('lls-api-key') || '';
        let currentChatContext = '';
        let chatHistory = [];

        function saveApiKey() {
            const input = document.getElementById('api-key-input');
            const key = input.value.trim();
            
            if (!key || !key.startsWith('sk-ant-')) {
                alert('âŒ Invalid API key. Must start with sk-ant-');
                return;
            }
            
            apiKey = key;
            localStorage.setItem('lls-api-key', key);
            document.getElementById('api-status').innerHTML = 'âœ… API key connected';
            input.value = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
            alert('âœ… API key saved! You can now use the AI Legal Tutor.');
        }

        function openAIChat(context = 'Law & Legal Skills') {
            console.log('openAIChat called with context:', context);
            console.log('apiKey status:', apiKey ? 'exists' : 'missing');
            
            if (!apiKey) {
                alert('âš ï¸ Please enter your Anthropic API key first to use the AI tutor.');
                return;
            }
            
            console.log('Opening chat modal...');
            currentChatContext = context;
            document.getElementById('chat-title').textContent = `ðŸŽ“ AI Legal Tutor - ${context}`;
            document.getElementById('chat-modal').classList.add('show');
            console.log('Modal should be visible now');
            
            // Welcome message
            if (chatHistory.length === 0) {
                console.log('Adding welcome message...');
                addAIMessage(`## Welcome to Your AI Legal Tutor! 

I'm here to help you master **${context}** with visual, engaging explanations.

### What I Can Help With

1. **Article Explanations** - "Explain Art. 6:74 DCC"
2. **Legal Concepts** - "What is consensus?"
3. **Procedures** - "How does GALA appeal work?"
4. **Case Analysis** - "Analyze this contract scenario"
5. **Exam Preparation** - "Key topics for the exam"

âœ… I'll use colors, boxes, and visual formatting
âœ… Always cite specific articles like Art. 3:32 DCC
âœ… Break down complex topics step-by-step

âš ï¸ Pro tip: The more specific your question, the better my answer!

ðŸ’¡ Ready to learn? Ask me anything about law!`);
            }
        }

        function closeChatModal() {
            document.getElementById('chat-modal').classList.remove('show');
        }

        function addAIMessage(text) {
            const messagesDiv = document.getElementById('chat-messages');
            const msg = document.createElement('div');
            msg.className = 'chat-message ai';
            msg.innerHTML = `
                <div class="chat-avatar">ðŸŽ“</div>
                <div class="chat-bubble">${formatMarkdown(text)}</div>
            `;
            messagesDiv.appendChild(msg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            chatHistory.push({ role: 'assistant', content: text });
        }

        function addUserMessage(text) {
            const messagesDiv = document.getElementById('chat-messages');
            const msg = document.createElement('div');
            msg.className = 'chat-message user';
            msg.innerHTML = `
                <div class="chat-avatar">ðŸ‘¤</div>
                <div class="chat-bubble">${text}</div>
            `;
            messagesDiv.appendChild(msg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            chatHistory.push({ role: 'user', content: text });
        }

        function formatMarkdown(text) {
            // Escape HTML first
            text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            // ========== ENHANCED VISUAL FORMATTING ==========
            
            // Diagram/Flow boxes (```diagram ... ```)
            text = text.replace(/```diagram\s+([\s\S]+?)```/g, '<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 3px solid #475569; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; font-family: monospace; white-space: pre-wrap; line-height: 1.6; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"><div style="background: #475569; color: white; padding: 0.5rem 1rem; border-radius: 6px; margin-bottom: 1rem; font-weight: 600; text-align: center;">ðŸ“Š DIAGRAM</div>$1</div>');
            
            // Headers (## Header)
            text = text.replace(/^## (.+)$/gm, '<h3 style="color: #1e3a8a; font-size: 1.4rem; margin: 2rem 0 1rem 0; padding: 0.75rem 1rem; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left: 5px solid #1e3a8a; border-radius: 8px; box-shadow: 0 2px 8px rgba(30, 58, 138, 0.15);">$1</h3>');
            
            // Bold text with highlight (**text**)
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong style="background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%); padding: 3px 8px; border-radius: 5px; color: #78350f; font-weight: 700;">$1</strong>');
            
            // Italic text (*text*)
            text = text.replace(/\*(.+?)\*/g, '<em style="color: #1e40af; font-weight: 500;">$1</em>');
            
            // Code blocks (```text```)
            text = text.replace(/```(.+?)```/gs, '<pre style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: #e2e8f0; padding: 1.25rem; border-radius: 10px; overflow-x: auto; margin: 1.5rem 0; border-left: 5px solid #3b82f6; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-family: \'Courier New\', monospace;"><code>$1</code></pre>');
            
            // Inline code (`text`)
            text = text.replace(/`(.+?)`/g, '<code style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 4px 10px; border-radius: 6px; font-family: \'Courier New\', monospace; font-size: 0.9em; color: #991b1b; font-weight: 600; border: 1px solid #fca5a5;">$1</code>');
            
            // Article references (Art. X)
            text = text.replace(/\b(Art\.?\s*[\d:]+\s*(?:DCC|GALA|PC|CCP|C\.|ECHR|ICJ Statute)?)\b/gi, '<span style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 4px 12px; border-radius: 8px; font-weight: 700; font-size: 0.9em; display: inline-block; margin: 0 4px; box-shadow: 0 2px 6px rgba(30, 58, 138, 0.3);">ðŸ“œ $1</span>');
            
            // Numbered lists (1. Item)
            text = text.replace(/^(\d+)\.\s+(.+)$/gm, '<div style="margin: 0.75rem 0 0.75rem 1rem; padding: 1rem; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 5px solid #2563eb; border-radius: 10px; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15); display: flex; align-items: start;"><span style="display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border-radius: 50%; font-weight: 900; font-size: 0.95rem; margin-right: 1rem; box-shadow: 0 2px 6px rgba(37, 99, 235, 0.4);">$1</span><span style="flex: 1; padding-top: 4px;">$2</span></div>');
            
            // Bullet points (â€¢ Item or - Item)
            text = text.replace(/^[â€¢\-]\s+(.+)$/gm, '<div style="margin: 0.75rem 0 0.75rem 1rem; padding: 1rem; background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border-left: 5px solid #eab308; border-radius: 10px; box-shadow: 0 2px 8px rgba(234, 179, 8, 0.15); display: flex; align-items: start;"><span style="color: #ca8a04; font-size: 1.5rem; margin-right: 1rem; font-weight: bold; line-height: 1;">â†’</span><span style="flex: 1;">$1</span></div>');
            
            // Key points boxes (### Key Point)
            text = text.replace(/^### (.+)$/gm, '<div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid #10b981; border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);"><div style="display: flex; align-items: center; gap: 0.75rem;"><span style="font-size: 2rem;">ðŸ’¡</span><strong style="color: #065f46; font-size: 1.15rem; line-height: 1.4;">$1</strong></div></div>');
            
            // Warning boxes (âš ï¸ text)
            text = text.replace(/^âš ï¸\s+(.+)$/gm, '<div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 3px solid #f59e0b; border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);"><div style="display: flex; align-items: center; gap: 0.75rem;"><span style="font-size: 2rem;">âš ï¸</span><strong style="color: #92400e; line-height: 1.4;">$1</strong></div></div>');
            
            // Success/Check boxes (âœ“ text or âœ… text)
            text = text.replace(/^[âœ“âœ…]\s+(.+)$/gm, '<div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid #10b981; border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);"><div style="display: flex; align-items: center; gap: 0.75rem;"><span style="font-size: 2rem;">âœ…</span><span style="color: #065f46; font-weight: 600; line-height: 1.4;">$1</span></div></div>');
            
            // Error/Cross boxes (âœ— text or âŒ text)
            text = text.replace(/^[âœ—âŒ]\s+(.+)$/gm, '<div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 3px solid #ef4444; border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);"><div style="display: flex; align-items: center; gap: 0.75rem;"><span style="font-size: 2rem;">âŒ</span><span style="color: #991b1b; font-weight: 600; line-height: 1.4;">$1</span></div></div>');
            
            // Question boxes (â“ text or ? text at start of line)
            text = text.replace(/^[â“]\s+(.+)$/gm, '<div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); border: 3px solid #6366f1; border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);"><div style="display: flex; align-items: center; gap: 0.75rem;"><span style="font-size: 2rem;">â“</span><span style="color: #3730a3; font-weight: 600; line-height: 1.4;">$1</span></div></div>');
            
            // Step indicators (STEP 1: text)
            text = text.replace(/^STEP\s+(\d+):\s+(.+)$/gm, '<div style="background: linear-gradient(135deg, #fae8ff 0%, #f3e8ff 100%); border-left: 6px solid #a855f7; border-radius: 10px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.2);"><div style="display: flex; align-items: center; gap: 1rem;"><div style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; min-width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.25rem; box-shadow: 0 3px 10px rgba(168, 85, 247, 0.4);">$1</div><strong style="color: #581c87; font-size: 1.1rem; line-height: 1.4;">$2</strong></div></div>');
            
            // Dividers (--- or ***)
            text = text.replace(/^(---|\*\*\*)$/gm, '<hr style="border: none; border-top: 3px solid #e5e7eb; margin: 2rem 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">');
            
            // Comparison tables (VS comparison)
            text = text.replace(/^(.+?)\s+VS\s+(.+?)$/gm, '<div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; margin: 1.5rem 0; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"><div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 1rem; border-radius: 8px; border: 2px solid #3b82f6; text-align: center; font-weight: 600; color: #1e40af;">$1</div><div style="display: flex; align-items: center; font-size: 1.5rem; font-weight: 900; color: #64748b;">âš”ï¸</div><div style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 1rem; border-radius: 8px; border: 2px solid #ec4899; text-align: center; font-weight: 600; color: #9f1239;">$2</div></div>');
            
            // Paragraphs (double newline)
            text = text.replace(/\n\n/g, '</p><p style="margin: 1rem 0; line-height: 1.9; color: #1f2937;">');
            
            // Single line breaks
            text = text.replace(/\n/g, '<br>');
            
            // Wrap in paragraph
            return '<p style="margin: 1rem 0; line-height: 1.9; color: #1f2937;">' + text + '</p>';
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message || !apiKey) return;
            
            input.value = '';
            addUserMessage(message);
            
            // Show typing indicator
            document.getElementById('typing-indicator').style.display = 'block';
            document.getElementById('send-btn').disabled = true;
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2048,
                        system: buildSystemPrompt(),
                        messages: buildConversationHistory(message)
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                addAIMessage(data.content[0].text);
                
            } catch (error) {
                console.error('Chat error:', error);
                addAIMessage('âŒ Sorry, there was an error connecting to the AI. Please check your API key and try again.');
            } finally {
                document.getElementById('typing-indicator').style.display = 'none';
                document.getElementById('send-btn').disabled = false;
            }
        }

        function buildSystemPrompt() {
            return `You are an expert Law & Legal Skills tutor for the University of Groningen's LLS course.

COURSE COVERAGE:
- Constitutional Law (Dutch Constitution, separation of powers, judicial review Art. 120)
- Administrative Law (GALA: orders, interested parties, appeals, Arts. 1:1-8:72)
- Criminal Law (trial procedure, decision model Arts. 348-350 CCP, defences)
- Private Law/Contract (DCC: 4 requirements, damages Art. 6:74, breach remedies)
- International Law (ICJ, ECHR, treaties, customary law, usus + opinio iuris)

EXAM: October 28, 2025 | 200 points total | Pass: 110 points

VISUAL FORMATTING - USE EXTENSIVELY:
Your responses will be beautifully formatted with colors, boxes, and visual elements. Use these liberally:

**Headers:**
- ## Main Section Header (blue underline)

**Key Points & Tips:**
- ### Important Point (green box with ðŸ’¡)
- âš ï¸ Warning or caution (yellow box)
- âœ… Correct approach (green checkmark box)
- âŒ Common mistake (red error box)
- â“ Question to consider (purple question box)

**Step-by-Step:**
- STEP 1: First step (purple numbered circle)
- STEP 2: Second step (purple numbered circle)

**Lists:**
- 1. Numbered items (blue boxes with numbers)
- â€¢ Bullet points (yellow arrow boxes)

**Article References:**
- Always write Art. 6:74 DCC (auto-formatted with blue badge)
- Art. 3:33 DCC, Art. 8:70 GALA, etc. (each gets a badge)

**Emphasis:**
- **Bold text** (highlighted in yellow)
- *Italic text* (colored blue)
- \`code/article\` (gray box with red text)

**Examples:**
Use these liberally to make content visual and engaging!

TEACHING APPROACH:
- Start with ## header for main sections
- Use ### for key takeaways
- Number complex processes (1. 2. 3.)
- Use âœ… for correct methods, âŒ for wrong ones
- Use âš ï¸ for important warnings
- ALWAYS cite articles: Art. 6:74 DCC
- Break complex topics into STEP 1:, STEP 2:, etc.
- Use â€¢ bullets for lists of examples
- Keep responses 300-600 words
- Be visual, colorful, and engaging

Current topic context: ${currentChatContext}

EXAMPLE GOOD RESPONSE:
"## Contract Validity - The 4 Requirements

To form a valid contract under Dutch law, you need **all 4 requirements**:

1. **Capacity** (Art. 3:32 DCC) - Legal ability to enter contracts
2. **Consensus** (Art. 3:33 DCC) - Meeting of the minds
3. **Permissible Content** (Art. 3:40 DCC) - Not violate law/morality
4. **Determinability** (Art. 6:227 DCC) - Content must be certain

### Key Point
âœ… All 4 must be present - if one fails, no valid contract!

âš ï¸ Common mistake: Forgetting to check Art. 3:40 DCC on permissible content

â€¢ Capacity issues: minors, mentally incapacitated
â€¢ Consensus issues: fraud (Art. 3:44 DCC), mistake, duress"

Respond immediately with substantive, VISUALLY FORMATTED legal information.`;
        }

        function buildConversationHistory(newMessage) {
            // Keep last 10 messages for context
            const recentHistory = chatHistory.slice(-10);
            return [...recentHistory.map(m => ({ role: m.role, content: m.content })), 
                    { role: 'user', content: newMessage }];
        }

        // Make functions globally available
        window.openAIChat = openAIChat;
        window.saveApiKey = saveApiKey;
        window.closeChatModal = closeChatModal;
        window.sendChatMessage = sendChatMessage;
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI ASSESSMENT SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function submitAssessment() {
            if (!apiKey) {
                alert('âš ï¸ Please enter your Anthropic API key first to use AI assessment.');
                return;
            }
            
            const topic = document.getElementById('assessment-topic').value;
            const question = document.getElementById('assessment-question').value.trim();
            const answer = document.getElementById('assessment-answer').value.trim();
            
            if (!answer) {
                alert('âŒ Please write your answer first!');
                return;
            }
            
            const resultDiv = document.getElementById('assessment-result');
            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="typing-indicator" style="display: inline-block; margin: 0;">
                        <span></span><span></span><span></span>
                    </div>
                    <p style="margin-top: 1rem; color: var(--text-light);">AI is assessing your answer...</p>
                </div>
            `;
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 3000,
                        system: buildAssessmentPrompt(topic),
                        messages: [{
                            role: 'user',
                            content: question ? 
                                'Question/Prompt: ' + question + '\n\nMy Answer:\n' + answer : 
                                'Please assess this answer:\n\n' + answer
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                displayAssessment(data.content[0].text);
                
            } catch (error) {
                console.error('Assessment error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        âŒ Error connecting to AI. Please check your API key and try again.
                    </div>
                `;
            }
        }
        
        function buildAssessmentPrompt(topic) {
            return `You are an expert Law & Legal Skills assessor grading student answers for the University of Groningen LLS course.

CURRENT TOPIC: ${topic}

YOUR TASK - Provide detailed, VISUALLY FORMATTED assessment:

## GRADE: X/10 (use ## for this header)

Use these visual elements throughout:

### Strengths (green box)
âœ… What the student did well (each on its own line)
âœ… Correct citations
âœ… Good reasoning

### Weaknesses (yellow warning)
âš ï¸ What needs improvement (each on its own line)
âš ï¸ Missing elements
âš ï¸ Unclear explanations

### Corrections (red error boxes)
âŒ Error 1: Explanation with correct Art. X DCC citation
âŒ Error 2: Fix with proper article reference
âŒ Error 3: Correction

### Improvement Steps (purple steps)
STEP 1: First improvement suggestion
STEP 2: Second improvement suggestion  
STEP 3: Third improvement suggestion

### Key Takeaways (green tip boxes)
ðŸ’¡ Main lesson from this assessment
ðŸ’¡ Focus area for exam

GRADING RUBRIC:
- **9-10**: Excellent - Complete, accurate, well-structured, cites articles correctly
- **7-8**: Good - Mostly correct, minor errors, could be more detailed
- **5-6**: Satisfactory - Basic understanding but missing key elements or has errors
- **3-4**: Poor - Significant errors or missing crucial information
- **0-2**: Fail - Fundamental misunderstanding or mostly incorrect

FORMATTING RULES - USE EXTENSIVELY:
- ## for main sections (GRADE, STRENGTHS, etc.)
- ### for key insights/tips
- **bold** for grades, key terms, article names
- Art. 6:74 DCC format for all articles (gets blue badge)
- âœ… for each strength point
- âš ï¸ for each weakness
- âŒ for each error/correction
- STEP 1:, STEP 2: for improvement steps
- ðŸ’¡ for key takeaways
- 1. 2. 3. for numbered lists when appropriate
- â€¢ for bullet examples

EXAMPLE RESPONSE FORMAT:

## GRADE: 7/10

### Overall Assessment
This answer demonstrates **good understanding** of ${topic} but has some areas for improvement.

## Strengths

âœ… Correctly cited Art. 6:74 DCC for damages
âœ… Good structure with clear paragraphs
âœ… Understood the basic concept of consensus

## Weaknesses

âš ï¸ Missing citation for Art. 3:33 DCC on consensus
âš ï¸ Explanation of causation could be more detailed
âš ï¸ No mention of the reasonable person test

## Corrections Needed

âŒ You stated "fraud voids contract" - Actually fraud makes it **voidable** (Art. 3:44 DCC), not automatically void
âŒ Missing Art. 6:227 DCC - determinability requirement
âŒ Confused GALA appeal grounds - should cite Art. 8:69 GALA

## How to Improve

STEP 1: Always cite the specific article when making legal claims (e.g., Art. 3:32 DCC for capacity)
STEP 2: Use the 4-requirement framework: capacity, consensus, permissible content, determinability  
STEP 3: Distinguish between void (nietig) and voidable (vernietigbaar)

### Key Takeaway
ðŸ’¡ For ${topic} questions: Structure answer using relevant framework, cite specific articles, and be precise with legal terminology

Be constructive, specific, visual, and educational!`;
        }
        
        function displayAssessment(assessmentText) {
            const resultDiv = document.getElementById('assessment-result');
            const topicValue = document.getElementById('assessment-topic').value;
            resultDiv.innerHTML = `
                <div class="assessment-result" style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 2rem; animation: slideInChat 0.5s ease-out;">
                    ${formatMarkdown(assessmentText)}
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button class="btn btn-secondary" onclick="document.getElementById('assessment-answer').value=''; document.getElementById('assessment-result').innerHTML='';">
                        ðŸ“ Submit Another Answer
                    </button>
                    <button class="btn btn-outline" onclick="openAIChat('${topicValue}')" style="margin-left: 1rem;">
                        ðŸ¤– Ask AI Tutor
                    </button>
                </div>
            `;
            
            // Smooth scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        window.submitAssessment = submitAssessment;
        
        // Debug logging
        console.log('=== AI TUTOR DEBUG ===');
        console.log('apiKey:', apiKey ? 'Set' : 'Not set');
        console.log('openAIChat type:', typeof openAIChat);
        console.log('window.openAIChat type:', typeof window.openAIChat);
        console.log('Functions available:', {
            openAIChat: typeof openAIChat,
            saveApiKey: typeof saveApiKey,
            closeChatModal: typeof closeChatModal,
            sendChatMessage: typeof sendChatMessage,
            submitAssessment: typeof submitAssessment
        });
        console.log('Window functions:', {
            'window.openAIChat': typeof window.openAIChat,
            'window.saveApiKey': typeof window.saveApiKey,
            'window.closeChatModal': typeof window.closeChatModal,
            'window.sendChatMessage': typeof window.sendChatMessage,
            'window.submitAssessment': typeof window.submitAssessment
        });
    </script>

    <!-- Chat Modal -->
    <div id="chat-modal" class="chat-modal">
        <div class="chat-modal-content">
            <div class="chat-header">
                <h2 id="chat-title">ðŸŽ“ AI Legal Tutor</h2>
                <button class="chat-close" onclick="closeChatModal()">Ã—</button>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="typing-indicator" id="typing-indicator">
                <span></span><span></span><span></span>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Ask about articles, concepts, cases, procedures..." 
                       onkeypress="if(event.key==='Enter')sendChatMessage()">
                <button onclick="sendChatMessage()" id="send-btn">Send</button>
            </div>
        </div>
    </div>
</body>
</html>
