# LLS Study Portal - Environment Variables

# Anthropic API Key (required)
ANTHROPIC_API_KEY=your-anthropic-api-key-here

# Google Cloud Project (for deployment)
GCP_PROJECT_ID=vigilant-axis-483119-r8
GCP_REGION=europe-west4

# Application Settings
APP_NAME=lls-study-portal
PORT=8080

# Development Settings
DEBUG=False
LOG_LEVEL=INFO

# ECHR Case Law Database
# Directory for ECHR case law cache (SQLite database)
# Default: data/echr_cache
ECHR_CACHE_DIR=data/echr_cache

# ============================================================================
# GDPR & Security Settings
# ============================================================================

# GDPR Token Secret (REQUIRED for production)
# Used for generating secure tokens for account deletion, email verification, etc.
# Generate with: python3 -c "import secrets; print(secrets.token_hex(32))"
# IMPORTANT: Keep this secret! Never commit to version control!
# In production, store in Google Secret Manager
# GDPR_TOKEN_SECRET=your-64-character-hex-secret-here

# CSRF Protection - Allowed Origins (REQUIRED for production)
# Comma-separated list of allowed origins for file uploads and API requests
# Example: https://allms.app,https://www.allms.app
# Default: localhost origins (for development)
# ALLOWED_ORIGINS=https://allms.app,https://www.allms.app

# Rate Limiting Backend
# Options: memory (dev), redis (prod)
# Default: memory
RATE_LIMIT_BACKEND=memory

# Rate Limiting Configuration
# RATE_LIMIT_UPLOADS=10  # Max uploads per user per window
# RATE_LIMIT_WINDOW=60   # Window in seconds

# Redis Configuration (if RATE_LIMIT_BACKEND=redis)
# For production, use Cloud Memorystore for Redis
# REDIS_HOST=10.0.0.3  # Cloud Memorystore IP
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0
# REDIS_SSL=false

# File Storage Backend
# Options: local (dev), gcs (prod)
# Default: local
STORAGE_BACKEND=local

# Google Cloud Storage Configuration (if STORAGE_BACKEND=gcs)
# UPLOAD_BUCKET=allms-uploads  # GCS bucket name for uploads

# Email Service Provider (for GDPR confirmation emails)
# Options: console (dev), sendgrid, ses, smtp
# Default: console
EMAIL_SERVICE_PROVIDER=console

# SendGrid Configuration (if EMAIL_SERVICE_PROVIDER=sendgrid)
# SENDGRID_API_KEY=your-sendgrid-api-key

# ============================================================================
# Authentication Settings
# ============================================================================
#
# The application supports multiple authentication modes:
# - IAP: Google Cloud Identity-Aware Proxy (legacy, infrastructure-level)
# - OAuth: Application-level Google OAuth 2.0 (preferred)
# - Dual: Both modes for migration (OAuth takes priority)
#
# For local development: Set AUTH_ENABLED=false to use mock user mode
# For production: Set AUTH_ENABLED=true and configure auth mode
#

# Enable/disable authentication
# - true: Production mode with authentication required
# - false: Development mode with mock user (no auth required)
# Default: true
AUTH_ENABLED=false

# Authentication mode
# - oauth: Application-level OAuth (preferred for new deployments)
# - iap: Google Cloud IAP headers only (legacy)
# - dual: Try OAuth first, fallback to IAP (for migration)
# Default: iap
AUTH_MODE=iap

# Primary allowed domain
# Users with this email domain have full admin access.
# Default: mgms.eu
AUTH_DOMAIN=mgms.eu

# ============================================================================
# OAuth 2.0 Configuration (Required for AUTH_MODE=oauth or AUTH_MODE=dual)
# ============================================================================
#
# Create OAuth credentials in Google Cloud Console:
# APIs & Services > Credentials > Create OAuth 2.0 Client ID (Web Application)
#
# Add authorized redirect URI: https://your-domain.com/auth/callback
#

# Google OAuth Client ID
# Example: 123456789-abcdefghijklmnop.apps.googleusercontent.com
GOOGLE_OAUTH_CLIENT_ID=your-oauth-client-id.apps.googleusercontent.com

# Google OAuth Client Secret (STORE IN SECRET MANAGER IN PRODUCTION!)
# GOOGLE_OAUTH_CLIENT_SECRET=your-client-secret

# OAuth Redirect URI (must match Google Cloud Console configuration)
# Example: https://allms.app/auth/callback
OAUTH_REDIRECT_URI=http://localhost:8080/auth/callback

# Session Secret Key (REQUIRED for OAuth sessions)
# Generate with: python3 -c "import secrets; print(secrets.token_hex(32))"
# STORE IN SECRET MANAGER IN PRODUCTION!
# SESSION_SECRET_KEY=your-64-character-hex-secret-here

# Session Configuration
SESSION_COOKIE_NAME=lls_session
SESSION_EXPIRY_DAYS=7
SESSION_COOKIE_SECURE=false  # Set to true in production (requires HTTPS)
SESSION_COOKIE_SAMESITE=lax

# ============================================================================
# IAP Configuration (Required for AUTH_MODE=iap or AUTH_MODE=dual)
# ============================================================================

# Google Client ID for IAP JWT verification
# Get this from: Google Cloud Console > APIs & Services > Credentials
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com

# IAP Audience (optional, auto-detected if not set)
# Format: /projects/PROJECT_NUMBER/apps/PROJECT_ID
# Only needed if auto-detection fails
# IAP_AUDIENCE=/projects/123456789/apps/your-project-id

# ============================================================================
# Mock User Settings (LOCAL DEVELOPMENT ONLY)
# ============================================================================
#
# These settings are ONLY used when AUTH_ENABLED=false
# They configure the mock user for local development and testing
#

# Mock user email address
# - Use @mgms.eu for admin access (can access /api/admin/* endpoints)
# - Use other domains to test regular user access
# Examples:
#   - dev@mgms.eu (admin user)
#   - student@university.edu (regular user)
#   - guest@external.com (external user, simulates allow list)
AUTH_MOCK_USER_EMAIL=dev@mgms.eu

# Mock user admin status
# - true: User has admin privileges (can access admin endpoints)
# - false: Regular user (cannot access admin endpoints)
# Note: Admin status is automatically true for @mgms.eu domain users
AUTH_MOCK_USER_IS_ADMIN=true

# ============================================================================
# Authentication Quick Reference
# ============================================================================
#
# Local Development (no auth):
#   AUTH_ENABLED=false
#   AUTH_MOCK_USER_EMAIL=dev@mgms.eu
#   AUTH_MOCK_USER_IS_ADMIN=true
#
# Production with OAuth (recommended):
#   AUTH_ENABLED=true
#   AUTH_MODE=oauth
#   AUTH_DOMAIN=mgms.eu
#   GOOGLE_OAUTH_CLIENT_ID=your-oauth-client-id.apps.googleusercontent.com
#   GOOGLE_OAUTH_CLIENT_SECRET=your-client-secret  (or use Secret Manager)
#   OAUTH_REDIRECT_URI=https://your-domain.com/auth/callback
#   SESSION_SECRET_KEY=your-64-char-hex-secret  (or use Secret Manager)
#   SESSION_COOKIE_SECURE=true
#
# Production with IAP (legacy):
#   AUTH_ENABLED=true
#   AUTH_MODE=iap
#   AUTH_DOMAIN=mgms.eu
#   GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
#
# Migration mode (OAuth + IAP fallback):
#   AUTH_ENABLED=true
#   AUTH_MODE=dual
#   (Configure both OAuth and IAP settings above)
#
# See documentation:
#   - docs/AUTHENTICATION.md - Architecture overview
#   - docs/OAUTH-SETUP.md - OAuth configuration guide
#   - docs/IAP-SETUP.md - Legacy IAP setup
#   - docs/LOCAL-DEVELOPMENT.md - Local development guide
#   - docs/ALLOW-LIST-MANAGEMENT.md - Managing external users
#
